var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function updateCardData(){$.get(BattleCardDataUrl).then(function(e){var t="guid\tname\tklassType\telementType\trarityType\tturns\ttypesTargets\tbrag\tminValues\tmaxValues\ttier\tmats\tperkBase\tperks\teffects\tpacks";bh.Repo.mapTsv(e).map(function(e){try{var t=e.Id,r=bh.data.BattleCardRepo.find(t),n=e["Effect Type"].includes("/")?[0,1]:[0],a={guid:t,name:r&&r.name||e.Name,klassType:bh.KlassType[e.Class.replace("Ranged","Skill").replace("Melee","Might")],elementType:bh.ElementType[e.Element],rarityType:bh.RarityType[e.Rarity.replace(/ /,"")],turns:+e.Turns,typesTargets:e["Effect Type"].trim().split(/\s*\/\s*/),brag:bh.utils.parseBoolean(e["Is Brag?"]),minValues:n.map(function(t){return[0,1,2,3,4,5].map(function(t){return e[t+"* Min"]}).filter(function(e){return!!e}).map(function(e){return+String(e).split(/\s*\/\s*/)[t]})}),maxValues:[0,1,2,3,4,5].map(function(t){return e[t+"* Max"]}).filter(function(e){return!!e}).pop().split(/\s*\/\s*/).map(function(e){return+e}),tier:r&&r.tier||"",mats:[1,2,3,4].map(function(t){return e[t+"* Evo Jar"]}).filter(function(e){return!!e}),perkBase:+e["Perk %"],perks:[1,2].map(function(t){return e["Perk #"+t]}).filter(function(e){return!!e}),effects:[1,2,3].map(function(t){return e["Effect #"+t]}).filter(function(e){return!!e&&"Splash"!=e}),inPacks:bh.utils.parseBoolean(e["In Packs?"])};return r?r.name!=e.Name&&console.log(r.name+" !== "+e.Name):console.log("New Card: "+e.Name),a}catch(t){console.error(e)}return null}).filter(function(e){return!!e}).forEach(function(e){t+="\n"+e.guid+"\t"+e.name+"\t"+bh.KlassType[e.klassType].slice(0,2)+"\t"+bh.ElementType[e.elementType][0]+"\t"+bh.RarityType[e.rarityType][0]+"\t"+e.turns+"\t"+e.typesTargets.join("|")+"\t"+String(e.brag)[0]+"\t"+e.minValues.map(function(e){return e.join(",")}).join("|")+"\t"+e.maxValues.join("|")+"\t"+e.tier+"\t"+e.mats.join(",")+"\t"+e.perkBase+"\t"+e.perks.join(",")+"\t"+e.effects.join(",")+"\t"+String(e.inPacks)[0]}),$("#data-output").val(t)})}function rateCards(e){void 0===e&&(e=!0);var t=bh.data.BattleCardRepo.all.map(function(t){var r={configId:t.guid};return r.evolutionLevel=e?t.rarityType:0,r.level=e?bh.BattleCardRepo.getLevelsForRarity(t.rarityType)-1:0,{card:t,powerRating:bh.PowerRating.ratePlayerCard(r)}});return t.sort(function(e,t){return t.powerRating-e.powerRating}),$("textarea").val(t.map(function(e,t){return t+1+": "+e.powerRating+" - "+bh.RarityType[e.card.rarityType][0]+" "+e.card.name}).join("\n")),t}!function(e){var t=function(){function e(){this._cache={}}return e.prototype.clearCache=function(){this._cache={}},e.prototype.fromCache=function(e,t){return e in this._cache||(this._cache[e]=t()),this._cache[e]},e}();e.Cacheable=t}(bh||(bh={})),function(e){var t=function(e){function t(t){var r=e.call(this)||this;return r.data=t,r}return __extends(t,e),Object.defineProperty(t.prototype,"act",{get:function(){return this.data.act},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boosterElementTypes",{get:function(){return this.data.boosterElementTypes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boosterRarities",{get:function(){return this.data.boosterRarities},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"crystals",{get:function(){var e=this;return this.fromCache("crystals",function(){return e.data.crystals.map(function(t){return r(t,e.keys)})})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dungeon",{get:function(){return this.data.dungeon},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"difficulty",{get:function(){return this.data.difficulty},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"elementTypes",{get:function(){return this.data.elementTypes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fame",{get:function(){return this.data.fame},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guid",{get:function(){return this.data.guid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gold",{get:function(){return this.data.gold},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keys",{get:function(){return this.data.keys},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lower",{get:function(){return this.data.lower},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mats",{get:function(){var e=this;return this.fromCache("mats",function(){return e.data.mats.map(function(t){return r(t,e.keys)})})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.data.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"randomMats",{get:function(){return this.data.randomMats},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"runes",{get:function(){var e=this;return this.fromCache("runes",function(){return e.data.runes.map(function(t){return r(t,e.keys)})})},enumerable:!0,configurable:!0}),t.prototype.findDrop=function(e){var t=this.crystals.find(function(t){return t.name==e.split(" ")[0]})||this.runes.find(function(t){return t.name==e.split("'")[0]})||this.mats.find(function(t){return t.name==e});return t&&{dungeon:this,dropRate:t}||null},t}(e.Cacheable);function r(e,t){var r=e.split("|"),n=+r[1].match(/(\d+)/)[1]/100,a=r[2].split("-"),i=+a[0],o=+a[1]||i,u=(i+o)/2*n,s=u/t;return console.log([e,a,i,o,n,u,s]),{name:r[0],percent:r[1],percentMultiplier:n,min:i,max:o,average:u,averagePerKey:s}}e.Dungeon=t}(bh||(bh={})),function(e){var t,r,n,a,i,o;(t=e.AbilityType||(e.AbilityType={}))[t.Trait=0]="Trait",t[t.Active=1]="Active",t[t.Passive=2]="Passive",(r=e.ElementType||(e.ElementType={}))[r.Fire=0]="Fire",r[r.Earth=1]="Earth",r[r.Air=2]="Air",r[r.Spirit=3]="Spirit",r[r.Water=4]="Water",r[r.Neutral=5]="Neutral",(n=e.ItemType||(e.ItemType={}))[n.EvoJar=0]="EvoJar",n[n.Crystal=1]="Crystal",n[n.Rune=2]="Rune",(a=e.KlassType||(e.KlassType={}))[a.Magic=0]="Magic",a[a.Might=1]="Might",a[a.Skill=2]="Skill",(i=e.PositionType||(e.PositionType={}))[i.Member=0]="Member",i[i.Elder=1]="Elder",i[i.CoLeader=2]="CoLeader",i[i.Leader=3]="Leader",(o=e.RarityType||(e.RarityType={}))[o.Common=0]="Common",o[o.Uncommon=1]="Uncommon",o[o.Rare=2]="Rare",o[o.SuperRare=3]="SuperRare",o[o.Legendary=4]="Legendary"}(bh||(bh={})),function(e){var t=function(){return function(t,r){this.wildCards=e.data.wildsForEvo(t.rarityType,r),this.minSot=e.data.getMinSotNeeded(t.rarityType,r),this.maxSot=e.data.getMaxSotNeeded(t.rarityType,r),this.minGold=e.data.getMinGoldNeeded(t.rarityType,r)}}();e.EvoReport=t;var r=function(){function r(r){this.reports=[];for(var n=r.evo,a=e.data.getMaxEvo(r.rarityType),i=n;i<a;i++)this.reports.push(new t(r,i))}return Object.defineProperty(r.prototype,"next",{get:function(){return this.reports[0]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"wildCards",{get:function(){return this.reports.reduce(function(e,t){return e+t.wildCards},0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"minSot",{get:function(){return this.reports.reduce(function(e,t){return e+t.minSot},0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxSot",{get:function(){return this.reports.reduce(function(e,t){return e+t.maxSot},0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"minGold",{get:function(){return this.reports.reduce(function(e,t){return e+t.minGold},0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxGold",{get:function(){return this.reports.reduce(function(e,t){return e+t.maxGold},0)},enumerable:!0,configurable:!0}),r}();e.EvoReportCard=r}(bh||(bh={})),function(e){var t=function(){function r(t){this.raw=t;var n=r.matchEffect(t),a=n&&n[1]||t,i=e.data.EffectRepo.find(a);this.effect=i&&i.name||a,this.percent=n&&n[2]&&n[2]+"%"||null,this.percentMultiplier=this.percent&&+n[2]/100||null,this.turns=n&&+n[3]||null,this.value=i&&i.value,this.perkMultiplier=0,this.offense=!(i&&i.value||"").toLowerCase().startsWith("d"),this.rawTarget=n&&n[4]||null}return r.matchEffect=function(e){return"Critical"==e?["Critical","Critical"]:"Splash Enemy"==e?["Splash","Splash"]:e.match(/([a-zA-z]+(?: [a-zA-Z]+)*)(?: (\d+)%)?(?: (\d+)T)?(?: (Enemy|Ally|Self))/)},Object.defineProperty(r.prototype,"powerRating",{get:function(){return function(e){if(["Critical","Regen","Splash Damage"].includes(e.effect))return 0;var t=(e.value||"").toUpperCase().match(/(O|D)?((?:\+|\-)?\d+(?:\.\d+)?)(T)?(%)?/),r=t&&"O"==t[1],n=t&&"D"==t[1],a=t&&+t[2]||1,i=t&&"T"==t[3]?e.turns:1,o=t&&"%"==t[4]?e.percentMultiplier:1,u=t?a*i*o:.5,s=e.target,l=s&&s.offense,c=s&&!s.offense,d=l==r||c==n?1:-1,p=e.perkMultiplier||1;return s?u*p*d:(console.warn("no target",e),0)}(this)},enumerable:!0,configurable:!0}),r.parse=function(e){if(!e)return null;var t=new r(e);return t.effect&&t||null},r.parseAll=function(n){var a,i,o,u,s=e.data.BattleCardRepo.find(n.configId),l=e.BattleCardRepo.getPerk(s,n.evolutionLevel)/100,c=[];return s.effects.forEach(function(e){var t=r.parse(e);if(!t)return console.error("GameEffect.parse: "+e);t.card=s,c.push(t)}),s.perks.forEach(function(e){var t=r.parse(e);if(!t)return console.error("GameEffect.parse: "+e);t.card=s,t.perkMultiplier=l,c.push(t)}),a=c,i=s.typesTargets.map(function(t){return e.PlayerBattleCard.parseTarget(t)}),o=i.find(function(e){return"Damage"==e.type}),u=i.find(function(e){return["Heal","Shield"].includes(e.type)}),a.slice().forEach(function(r){if(["Leech","Sap"].includes(r.effect)&&(r.rawTarget="Enemy"),"Critical"==r.effect)r.target=i[0],i.slice(1).forEach(function(e){var n=t.parse(r.raw);n.target=e,a.push(n)});else if("Splash Damage"==r.effect);else if("Enemy"==r.rawTarget)r.target=o||e.PlayerBattleCard.parseTarget(u.all?"Damage All Enemies":"Damage Single Enemy");else if("Ally"==r.rawTarget){var n=u&&u.type||"Heal";r.target=e.PlayerBattleCard.parseTarget((o||u).all?n+" All Allies":n+" Single Ally")}else if("Self"==r.rawTarget){var n=u&&u.type||"Heal";r.target=e.PlayerBattleCard.parseTarget(n+" Self")}else r.target||console.warn("can't find target for "+r.effect,r.card)}),c},r}();e.GameEffect=t}(bh||(bh={})),function(e){function t(e,t){return{hero:e,guid:t.abilityGuid,name:t.abilityName,type:t.abilityType}}var r=function(){function r(e){var r=e[0],n=e[1],a=e[2];this.guid=r.heroGuid,this.name=r.heroName,this.elementType=r.elementType,this.klassType=r.klassType,this.trait=t(this,r),this.active=t(this,n),this.passive=t(this,a),this.lower=this.name.toLowerCase()}return Object.defineProperty(r.prototype,"abilities",{get:function(){return[this.trait,this.active,this.passive]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"allBattleCards",{get:function(){return r.filterCardsByHero(this,e.data.BattleCardRepo.all)},enumerable:!0,configurable:!0}),r.prototype.getHitPoints=function(e){return r.getHitPoints(this,e)},Object.defineProperty(r.prototype,"maxPowerRating",{get:function(){return e.PowerRating.rateMaxedHero(this)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxPowerThresholds",{get:function(){var t=this;return e.RarityRepo.allTypes.map(function(r){return e.PowerRating.rateMaxedHero(t,r)})},enumerable:!0,configurable:!0}),r.filterCardsByHero=function(t,r){return r.filter(function(r){return r.klassType===t.klassType&&(r.elementType==e.ElementType.Neutral||r.elementType==t.elementType)})},r.getHitPoints=function(e,t){switch(e.name){case"Bree":case"Hawkeye":case"Krell":return Math.floor(5*t*t+2.5*t+167.5);case"Monty":case"Trix":return Math.floor(4.286*t*t+2.142*t+143.572);case"Jinx":case"Logan":case"Red":return 4*t*t+2*t+134;case"Fergus":return 6*t*t+3*t+201;case"Brom":case"Gilda":return Math.floor(5.714*t*t+2.858*t+191.438);case"Peg":return Math.floor(4.5*t*t+2*t+153.5);case"Thrudd":return Math.floor(38/7*t*t+19/7*t+190-38/7-19/7);default:return 0}},r}();e.Hero=r}(bh||(bh={})),function(e){var t,r=function(){function r(e,t,n){void 0===n&&(n=null);var a=this;this.win=e,this.callbackfn=t,this._targetWindow=n,window.addEventListener("message",function(e){var t=e.data||e.originalEvent&&e.originalEvent.data||null;r.isValidMessage(t)&&(a.updateActive(t),a.callbackfn(t))})}return Object.defineProperty(r.prototype,"targetWindow",{get:function(){if(!this._targetWindow){if(e.isHud){var t=e.$("#gameiframe")[0];this._targetWindow=t&&t.contentWindow||null}e.isListener&&(this._targetWindow=this.win&&this.win.parent||null)}return this._targetWindow||console.log("no target window: "+location.href),this._targetWindow},enumerable:!0,configurable:!0}),r.prototype.updateActive=function(e){e.playerGuid!==e.action&&e.sessionKey!==e.action&&(r.ActivePlayerGuid&&r.ActivePlayerGuid===e.playerGuid||(r.ActivePlayerGuid=e.playerGuid),r.ActiveSessionKey&&r.ActiveSessionKey===e.sessionKey||(r.ActiveSessionKey=e.sessionKey))},r.prototype.postMessage=function(e){r.isValidMessage(e)&&this.targetWindow?(this.updateActive(e),this.targetWindow.postMessage(e,"*")):this.targetWindow?console.log("invalid message: "+(e&&e.action||"[no message]")):console.log("no target window: "+(e&&e.action||"[no message]"))},r.isValidMessage=function(e){if(!e)return!1;var t=Object.keys(e);return t.includes("action")&&t.includes("playerGuid")&&t.includes("sessionKey")&&t.includes("data")},r.createMessage=function(e,t){return{action:e,playerGuid:r.ActivePlayerGuid,sessionKey:r.ActiveSessionKey,data:t}},r.initialize=function(e,n){return t=new r(e,n)},Object.defineProperty(r,"instance",{get:function(){return t},enumerable:!0,configurable:!0}),r}();e.Messenger=r}(bh||(bh={})),function(e){function t(t,r,n,a){return"number"==typeof a&&(a=e.utils.formatNumber(a)),'<div data-hud="true">'+e.getImg20(t,r)+" "+n+'<span class="badge pull-right">'+a+"</span></div>"}var r=function(r){function n(t,n){void 0===n&&(n=!1);var a=r.call(this)||this;return a.isArena=n,e.data.isPlayer(t)&&(a._pp=t),e.data.isGuildPlayer(t)&&(a._gp=t),a}return __extends(n,r),Object.defineProperty(n.prototype,"fameLevel",{get:function(){return(this._pp&&this._pp.fameLevel||this._gp.fameLevel)+1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fragments",{get:function(){return this._pp&&this._pp.fragments||0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fragmentsRowHtml",{get:function(){return this._pp?t("misc","Fragments","Fragments",this.fragments):""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"gems",{get:function(){return this._pp&&this._pp.gems||0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"gemsRowHtml",{get:function(){return this._pp?t("misc","GemStone","Gems",this.gems):""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"gold",{get:function(){return this._pp&&this._pp.gold||0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"goldNeeded",{get:function(){var e=this;return this.fromCache("goldNeeded",function(){var t=0;return e.activeBattleCards.forEach(function(e){return t+=e.maxMaxGoldNeeded}),e.heroes.forEach(function(e){return t+=e?e.trait.maxGoldCost+e.active.maxGoldCost+e.passive.maxGoldCost:0}),t})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"goldRowHtml",{get:function(){var r=this.goldNeeded,n=r?e.utils.formatNumber(this.gold)+" / "+e.utils.formatNumber(Math.abs(r))+"<sup>*</sup>":e.utils.formatNumber(this.gold);return this._pp?t("misc","Coin","Gold",n):""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"guid",{get:function(){return this._pp&&this._pp.id||this._gp.playerId},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"guild",{get:function(){return e.data.guilds.findByGuid(this.guildGuid)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"guildGuid",{get:function(){return this._pp?this._pp.playerGuild||null:this._gp&&this._gp.guildId||null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"guildParent",{get:function(){var t=e.data.guilds.findNameByGuid(this.guildGuid);return t&&t.parent||null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"guilds",{get:function(){var t=this,r=this.fromCache("guilds",function(){return e.data.guilds.filterNamesByParent(t.guildParent)});if(!r.length){var n=e.data.guilds.findNameByGuid(this.guildGuid);n&&r.push(n)}return r},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"heroes",{get:function(){var t=this;return this.fromCache("heroes",function(){return(t._pp?e.data.HeroRepo.all.map(function(r){return t._pp.archetypes.find(function(e){return e.id==r.guid})||e.HeroRepo.getLockedArchetype(t.guid,r.guid)}):Object.keys(t._gp.archetypeLevels).map(function(e){return{playerId:t.guid,id:e,level:t._gp.archetypeLevels[e]}})).map(function(r){return new e.PlayerHero(t,r)})})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isAlly",{get:function(){var e=this;return this.fromCache("isAlly",function(){return!!(n.me&&n.me.guilds||[]).find(function(t){return t.guid==e.guildGuid})})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canScout",{get:function(){return"b0a8b57b-54f5-47d8-8b7a-f9dac8300ca0"==this.guid},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"completionPercent",{get:function(){return Math.floor(100*this.heroes.map(function(e){return e.completionLevel}).reduce(function(e,t){return e+t},0)/(e.HeroRepo.MaxCompletionLevel*e.HeroRepo.MaxHeroCount))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isExtended",{get:function(){return!!this._pp},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isFullMeat",{get:function(){return this.heroes.filter(function(e){return!e.isLocked&&e.isMeat}).length==e.HeroRepo.MaxHeroCount},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isMe",{get:function(){return e.Messenger.ActivePlayerGuid==this.guid},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._pp?this._pp.name:this._gp&&this._gp.name||null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"position",{get:function(){return this._gp&&this._gp.position||null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"powerRating",{get:function(){var e=this;return this.fromCache("poewrRating",function(){return e.heroes.reduce(function(e,t){return e+t.powerRating},0)})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"raidRowHtml",{get:function(){return this._pp?t("keys","RaidTicket","Raid Tickets",this.raidTickets):""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"raidTickets",{get:function(){return this._pp&&this._pp.raidKeys||0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"battleCards",{get:function(){var e=this;return this.fromCache("battleCards",function(){return e._pp&&e._pp.playerCards&&e._pp.playerCards.cards?e.sortAndReduceBattleCards(Object.keys(e._pp.playerCards.cards)):[]})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"activeBattleCards",{get:function(){var e=this;return this.fromCache("activeBattleCards",function(){return e.battleCards.filter(function(e){return e.isActive})})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"activeRecipes",{get:function(){var t=this;return this.fromCache("activeRecipes",function(){return t.activeBattleCards.map(function(t){return new e.Recipe(t,!0)}).filter(function(e){return!!e})})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boosterCards",{get:function(){var t=this._pp&&this._pp.feederCardsMap;return t?Object.keys(t).map(function(r){return new e.PlayerBoosterCard(r,t[r])}).sort(e.utils.sort.byElementThenRarityThenName):[]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boosterCount",{get:function(){var e=0,t=this._pp&&this._pp.feederCardsMap||{};return Object.keys(t).map(function(r){return e+=t[r]}),e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boosterRowHtml",{get:function(){return this._pp?e.PlayerBoosterCard.rowHtml(this.boosterCount):""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inventory",{get:function(){var t=this,r=this._pp&&this._pp.craftingMaterials;return e.data.ItemRepo.allSortedByName.map(function(n){return new e.PlayerInventoryItem(t,n,r[n.guid]||0)})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"wildCards",{get:function(){var t=this;return this.fromCache("wildCards",function(){return e.data.WildCardRepo.all.map(function(r){return new e.PlayerWildCard(t,r.guid)})})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"wildCardRowHtml",{get:function(){return this._pp?t("cardtypes","WildCard","Wild Cards",this.wildCards.filter(function(e){return e.count}).slice(-3).map(function(t){return e.RarityType[t.rarityType][0]+":"+t.count}).join(" / ")):""},enumerable:!0,configurable:!0}),n.prototype.battleCardToPlayerBattleInfo=function(t){var r=this._pp.playerCards.cards[t];return new e.PlayerBattleCard(r)},n.prototype.filterActiveBattleCards=function(){for(var t,r,n,a,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return i.forEach(function(a){return e.ElementRepo.isElement(a)?t=a:e.RarityRepo.isRarity(a)?r=a:n=a}),n&&(a=e.data.HeroRepo.find(n)),this.activeBattleCards.filter(function(e){return e.matchesElement(t)&&e.matchesRarity(r)&&e.matchesHero(a)})},n.prototype.filterHeroes=function(t){var r=e.ElementRepo.isElement(t)?t:null,n=r?null:t;return this.heroes.filter(function(t){return t&&(r&&e.ElementType[t.elementType]==r||n&&t.name==n)})},n.prototype.findPlayerCard=function(e){var t=this._pp&&this._pp.playerCards.cards,r=t&&t[e];if(!r&&t){var n=Object.keys(t).find(function(r){return r==e||t[r].configId==e});r=t[n]}return r},n.prototype.merge=function(e){var t=this._pp&&this._pp.archetypes||[];(e.archetypes||[]).forEach(function(e){t.find(function(t){return t.id==e.id})||t.push(e)})},n.prototype.sortAndReduceBattleCards=function(t){var r=this,n=[];return t.map(function(e){return r.battleCardToPlayerBattleInfo(e)}).sort(e.utils.sort.byRarityThenNameThenEvoLevel).forEach(function(e){var t=n.find(function(t){return t.matches(e)});t?t.count++:n.push(e)}),n},Object.defineProperty(n,"me",{get:function(){return e.data.PlayerRepo.find(e.Messenger.ActivePlayerGuid)},enumerable:!0,configurable:!0}),n}(e.Cacheable);e.Player=r}(bh||(bh={})),function(e){var t=function(){function t(t){this.count=1,this.playerCard=t,this._bc=e.data.BattleCardRepo.find(t.configId),this._bc||e.utils.logMissingCard(this)}return t.prototype._rowChildren=function(){var t=this,r="";if(!this.isUnknown){var n=e.Player.me,a=new e.Recipe(this,!0);if(a){var i=e.data.calcMaxGoldNeeded(this.playerCard,this.evoLevel)*this.count,o=n.gold,u=o<i?"bg-danger":"bg-success";r+="<div>"+e.getImg20("misc","Coin")+' Gold <span class="badge pull-right '+u+'">'+e.utils.formatNumber(o)+" / "+e.utils.formatNumber(i)+"</span></div>",a.all.forEach(function(a){if(a.max){var i=a.item,o=i.guid,u=n.inventory.find(function(e){return e.guid==o}),s=u&&u.count||0;r+=e.PlayerInventoryItem.toRowHtml(i,s,a.max*t.count)}});var s=e.data.getMaxWildCardsNeeded(this)*this.count,l=n.wildCards[this.rarityType],c=!l&&e.data.WildCardRepo.find(e.RarityType[this.rarityType])||null,d=l&&n.wildCards[this.rarityType].count||0;r+=e.PlayerWildCard.toRowHtml(l||c,d,s);var p=e.data.calcMaxRunesNeeded(this.playerCard,this.evoLevel),f=n.inventory.find(function(r){return r.isRune&&t.matchesHero(e.data.HeroRepo.find(r.name.split("'")[0]))}),y=f&&f.count||0;p&&f&&(r+=e.PlayerInventoryItem.toRowHtml(f,y,p));var g=e.data.calcMaxCrystalsNeeded(this.playerCard,this.evoLevel),h=n.inventory.find(function(e){return e.isCrystal&&t.elementType==e.elementType}),m=h&&h.count||0;g&&h&&(r+=e.PlayerInventoryItem.toRowHtml(h,m,g))}}return r},t.prototype._rowHtml=function(t,r){var n=t?'<span class="badge pull-right '+(r||"")+'">'+t+"</span>":"",a="number"==typeof t||this.isMaxed?"":this._rowChildren(),i=e.renderExpandable(this.playerCard.id,""+this.fullHtml+n,a);return'<div -class="'+e.ElementType[this.elementType]+'" data-element-type="'+this.elementType+'" data-rarity-type="'+this.rarityType+'" data-klass-type="'+this.klassType+'" data-brag="'+(this.brag?"Brag":"")+'">'+i+"</div>"},Object.defineProperty(t.prototype,"brag",{get:function(){return this._bc&&this._bc.brag||!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"effects",{get:function(){return this._bc&&this._bc.effects||[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"elementType",{get:function(){return this._bc?this._bc.elementType:e.ElementType.Neutral},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inPacks",{get:function(){return this._bc&&this._bc.inPacks||!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"klassType",{get:function(){return this._bc?this._bc.klassType:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lower",{get:function(){return this.name.toLowerCase()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mats",{get:function(){return this._bc&&this._bc.mats||null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxValues",{get:function(){return this._bc&&this._bc.maxValues||[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minValues",{get:function(){return this._bc&&this._bc.minValues||[[]]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOp",{get:function(){return this._bc&&this._bc.isOp||!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"perkBase",{get:function(){return this._bc&&this._bc.perkBase||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"perks",{get:function(){return this._bc&&this._bc.perks||[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._bc&&this._bc.name||this.playerCard&&this.playerCard.configId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rarityType",{get:function(){return this._bc?this._bc.rarityType:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"targets",{get:function(){return this.typesTargets.map(function(e){return e.trim()}).filter(function(e){return!!e}).map(function(e){var t=e.split(" "),r="All"==t[1],n="Single"==t[1],a="Splash"==t[1],i="Self"==t[1];if(e.includes("Flurry")){if(i)return"Self Flurry";if(r)return"Multi Flurry";if(n)return"Single Flurry"}return i?"Self":n?"Single":r?"Multi":a?"Splash":(console.log('Target of "'+e+'"'),e)})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"turns",{get:function(){return this._bc&&this._bc.turns||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tier",{get:function(){return this._bc&&this._bc.tier||null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"types",{get:function(){return this.typesTargets.map(function(e){return e.split(" ")[0].replace("Damage","Attack")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"typesTargets",{get:function(){return this._bc&&this._bc.typesTargets||[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"evo",{get:function(){return this.playerCard&&this.playerCard.evolutionLevel||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guid",{get:function(){return this.playerCard&&this.playerCard.configId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this.playerCard&&this.playerCard.level+1||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"battleOrBragImage",{get:function(){return e.getImg20("cardtypes",this.brag?"Brag":"BattleCard")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"evoLevel",{get:function(){return this.evo+"."+("0"+this.level).slice(-2)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"formattedValue",{get:function(){return this.value?e.utils.formatNumber(this.value):""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullHtml",{get:function(){var t=this.count>1?"x"+this.count:"",r=this.value?" ("+this.typeImage+" "+this.formattedValue+")":"",n=e.utils.evoToStars(this.rarityType,this.evoLevel),a=this.name.replace(/Mischievous/,"Misch.").replace(/Protection/,"Prot.").replace(/-[\w-]+-/,"-...-");return this.battleOrBragImage+" "+this.evoLevel+" <small>"+n+"</small> "+a+" "+r+" "+t+'<span class="pull-right">'+Math.round(this.powerRating)*this.count+"</span>"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isActive",{get:function(){return(this.evo>0||this.level>1)&&!this.isMaxed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isMaxed",{get:function(){return this.evoLevel==["1.10","2.20","3.35","4.50","5.50"][this.rarityType]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isUnknown",{get:function(){return!this._bc},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxWildCardsNeeded",{get:function(){return e.data.getMaxWildCardsNeeded(this)*this.count},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextWildCardsNeeded",{get:function(){return e.data.getNextWildCardsNeeded(this)*this.count},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxMaxSotNeeded",{get:function(){return e.data.calcMaxSotNeeded(this.playerCard,this.evoLevel)*this.count},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextMaxSotNeeded",{get:function(){return e.data.getMaxSotNeeded(this.rarityType,this.evo)*this.count},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxMaxGoldNeeded",{get:function(){return e.data.calcMaxGoldNeeded(this.playerCard,this.evoLevel)*this.count},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextMaxGoldNeeded",{get:function(){return e.data.getMaxGoldNeeded(this.rarityType,this.evo)*this.count},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"powerRating",{get:function(){return e.PowerRating.ratePlayerCard(this.playerCard)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rarityEvoLevel",{get:function(){return e.RarityType[this.rarityType][0]+"."+this.evoLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowHtml",{get:function(){return this._rowHtml()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoutHtml",{get:function(){return this.rarityEvoLevel+" "+this.name+" "+(this.count>1?"x"+this.count:"")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"typeImage",{get:function(){return this.types.length?e.getImg12("cardtypes",this.types[0]):""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.playerCard&&e.BattleCardRepo.calculateValue(this.playerCard)||0},enumerable:!0,configurable:!0}),t.prototype.matches=function(e){return this._bc&&e._bc&&this._bc.guid==e._bc.guid&&this.evoLevel==e.evoLevel},t.prototype.matchesElement=function(t){return!t||this.elementType===e.ElementType[t]},t.prototype.matchesHero=function(t){return!t||this.matchesElement(e.ElementType[t.elementType])&&this.klassType===t.klassType},t.prototype.matchesRarity=function(t){return!t||this.rarityType===e.RarityType[t]},t.prototype.toRowHtml=function(e,t){return this._rowHtml(e,t<e?"bg-danger":"bg-success")},t.parseTarget=function(e){var t=e.split("Flurry")[0].trim().split(" "),r=t.shift(),n=t.join(" "),a="Damage"==r,i=n.includes("All Allies")||n.includes("All Enemies"),o=n.includes("Splash"),u=n.includes("Self"),s=!i&&!o&&!u,l=e.match(/Flurry \((\d+) @ (\d+)%\)/),c=l&&+l[1]||null,d=l&&l[2]+"%"||null,p=l&&+l[2]/100||null;return{type:r,typeDivisor:"Damage"==r?AttackDivisor:"Shield"==r?ShieldDivisor:HealDivisor,target:n,offense:a,all:i,splash:o,single:s,self:u,targetMultiplier:i?a?3:2:o?a?2:1.5:s?a?1:1.25:u?1:0,flurry:!!l,flurryCount:c,flurryHitPercent:d,flurryHitMultiplier:p}},t}();e.PlayerBattleCard=t}(bh||(bh={})),function(e){var t=function(){function t(t,r){void 0===r&&(r=0),this.count=r,this.type="BoosterCard",this._=e.data.BoosterCardRepo.find(t)}return Object.defineProperty(t.prototype,"challenge",{get:function(){return this._.challenge},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"elementType",{get:function(){return this._.elementType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guid",{get:function(){return this._.guid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rarityType",{get:function(){return this._.rarityType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowHtml",{get:function(){return'<div class="'+e.ElementType[this.elementType]+'" data-element-type="'+this.elementType+'" data-type="'+this.type+'" data-rarity-type="'+this.rarityType+'">'+e.getImg20("misc","Boosters")+" "+e.RarityType[this.rarityType][0]+(this.challenge?"*":"")+" "+this.name+' <span class="badge pull-right">'+e.utils.formatNumber(this.count)+"</span></div>"},enumerable:!0,configurable:!0}),t.rowHtml=function(t){return'<div data-hud="true">'+e.getImg20("misc","Boosters")+' Boosters <span class="badge pull-right">'+e.utils.formatNumber(t)+"</span></div>"},t}();e.PlayerBoosterCard=t}(bh||(bh={})),function(e){function t(e,t){var r=e.archetype.abilityLevels?e.archetype.abilityLevels[e.hero.abilities[t].guid]:null;return isNaN(r)?0:r+1}var r=function(r){function n(t,n){var a=r.call(this)||this;return a.player=t,a.archetype=n,a.hero=e.data.HeroRepo.find(n.id),a}return __extends(n,r),n.prototype.getAbilityLevel=function(e){var t=this.archetype.abilityLevels?this.archetype.abilityLevels[this.hero.abilities[e].guid]:null;return isNaN(t)?0:t+1},Object.defineProperty(n.prototype,"abilities",{get:function(){return this.hero.abilities},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"abilityLevels",{get:function(){return this.archetype.abilityLevels},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"active",{get:function(){var r=this;return this.fromCache("active",function(){return new e.PlayerHeroAbility(r,r.hero.active,t(r,e.AbilityType.Active))})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"guid",{get:function(){return this.hero.guid},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"elementType",{get:function(){return this.hero.elementType},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"klassType",{get:function(){return this.hero.klassType},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this.hero.name},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"passive",{get:function(){var r=this;return this.fromCache("passive",function(){return new e.PlayerHeroAbility(r,r.hero.passive,t(r,e.AbilityType.Passive))})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"trait",{get:function(){var r=this;return this.fromCache("trait",function(){return new e.PlayerHeroAbility(r,r.hero.trait,t(r,e.AbilityType.Trait))})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"battleCards",{get:function(){var t=this;return this.fromCache("battleCards",function(){return e.Hero.filterCardsByHero(t.hero,t.player.battleCards)})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"completionLevel",{get:function(){return this.level+this.trait.level+this.active.level+this.passive.level},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"deck",{get:function(){var e=this;return this.fromCache("deck",function(){return e.player.sortAndReduceBattleCards(e.archetype.deck)})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hitPoints",{get:function(){return this.hero.getHitPoints(this.level)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isCapped",{get:function(){return this.active.isCapped&&this.passive.isCapped&&this.trait.isCapped},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLocked",{get:function(){return this.archetype.locked},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isMeat",{get:function(){return this.level==e.HeroRepo.MaxLevel&&this.isCapped},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"level",{get:function(){return this.archetype.level+1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isOp",{get:function(){return!!this.deck.find(function(e){return"OP"==e.tier})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"playerHeroAbilities",{get:function(){return[this.trait,this.active,this.passive]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"playerHeroGuid",{get:function(){return this.player.guid+"-"+this.hero.guid},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"powerPercent",{get:function(){return Math.floor(100*this.powerRating/this.hero.maxPowerRating)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"powerRating",{get:function(){var t=this;return this.fromCache("powerRating",function(){return Math.round(e.PowerRating.ratePlayerHeroHitPoints(t)+t.trait.powerRating+t.active.powerRating+t.passive.powerRating+e.PowerRating.rateDeck(t.deck))})},enumerable:!0,configurable:!0}),n}(e.Cacheable);e.PlayerHero=r}(bh||(bh={})),function(e){function t(t,r){switch(t){case e.AbilityType.Trait:return(i=r)<2?1:i<10?2:i<18?3:i<25?4:i<33?5:i<41?6:i<49?7:i<56?8:i<64?9:i<72?10:i<80?11:i<87?12:i<95?13:i<103?14:15;case e.AbilityType.Active:return(a=r)<2?1:a<7?3:a<13?4:a<18?5:a<23?6:a<28?7:a<33?8:a<38?9:a<43?10:a<48?11:a<53?12:a<58?13:a<63?14:a<68?15:a<73?16:a<78?17:a<83?18:19;case e.AbilityType.Passive:return(n=r)<2?2:n<6?4:n<9?5:n<12?6:n<16?7:n<19?8:n<22?9:n<26?10:n<29?11:n<32?12:n<36?13:n<39?14:n<42?15:n<46?16:n<49?17:n<52?18:n<56?19:n<59?20:n<62?21:n<66?22:23}var n,a,i}function r(e,r,n){for(var a=0,i=r+1,o=n+1;i<o;i++)a+=t(e,i);return a}function n(t,r){switch(t){case e.AbilityType.Trait:return function(e){if(1==e)return 1e3;for(var t=754,r=3e3,n=2;n<e;n++)r+=t,t+=8;return r}(r);case e.AbilityType.Active:return function(e){if(1==e)return 5e3;for(var t=510,r=3500,n=2;n<e;n++)r+=t,t+=20;return r}(r);case e.AbilityType.Passive:return function(e){if(1==e)return 7e3;for(var t=1015,r=1e4,n=2;n<e;n++)r+=t,t+=30;return r}(r)}}function a(e,t,r){for(var a=0,i=t+1,o=r+1;i<o;i++)a+=n(e,i);return a}e.getMaterialCountFor=t,e.getMaterialCountForRange=r,e.getGoldCostFor=n,e.getGoldCostForRange=a;var i=function(){function i(e,t,r){this.playerHero=e,this.heroAbility=t,this.level=r}return Object.defineProperty(i.prototype,"_type",{get:function(){if("Jinx"==this.hero.name){if(this.type==e.AbilityType.Active)return e.AbilityType.Passive;if(this.type==e.AbilityType.Passive)return e.AbilityType.Active}return this.type},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hero",{get:function(){return this.heroAbility.hero},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"guid",{get:function(){return this.heroAbility.guid},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this.heroAbility.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"type",{get:function(){return this.heroAbility.type},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isLocked",{get:function(){return!this.level},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isCapped",{get:function(){return this.level==this.levelCap},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isMaxed",{get:function(){return this.level==this.levelMax},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"levelCap",{get:function(){return e.HeroRepo.getAbilityLevelCap(this)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"levelMax",{get:function(){return e.HeroRepo.getAbilityLevelMax(this)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"nextMaterialCount",{get:function(){return t(this._type,this.level+1)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxMaterialCount",{get:function(){var t=this._type,n=e.HeroRepo.getAbilityMaxLevel(this.hero,this.heroAbility.type);return r(t,this.level,n)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"nextGoldCost",{get:function(){return n(this._type,this.level+1)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxGoldCost",{get:function(){this._type;var t=e.HeroRepo.getAbilityMaxLevel(this.hero,this.heroAbility.type);return a(this._type,this.level,t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"img",{get:function(){return e.getImg("skills",this.playerHero.name+e.AbilityType[this.type])},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"materialHtml",{get:function(){var t=this,r=this.playerHero.player,n=this.type==e.AbilityType.Trait?r.inventory.find(function(e){return e.isRune&&e.name.startsWith(t.hero.name)}):r.inventory.find(function(e){return e.isCrystal&&e.elementType==t.playerHero.elementType}),a=n.count,i=a<this.maxMaterialCount?"bg-danger":"bg-success";return"<div>"+(this.type==e.AbilityType.Trait?e.getImg("runes",this.name.replace(/\W/g,"")):e.getImg("crystals",e.ElementType[this.hero.elementType]))+" "+n.name+' <span class="badge pull-right '+i+'">'+e.utils.formatNumber(a)+" / "+e.utils.formatNumber(this.maxMaterialCount||0)+"</span></div>"},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"goldHtml",{get:function(){var t=this.playerHero.player.gold||0,r=t<this.maxGoldCost?"bg-danger":"bg-success";return"<div>"+e.getImg("misc","Coin")+' Gold <span class="badge pull-right '+r+'">'+e.utils.formatNumber(t)+" / "+e.utils.formatNumber(this.maxGoldCost||0)+"</span></div>"},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"powerRating",{get:function(){return e.PowerRating.ratePlayerHeroAbility(this)},enumerable:!0,configurable:!0}),i.prototype.toRowHtml=function(t,r){var n="number"==typeof t?'<span class="badge pull-right '+(t&&r?r<t?"bg-danger":"bg-success":"")+'">'+e.utils.formatNumber(t)+"</span>":"";return"<div>"+this.img+" "+this.playerHero.name+" "+e.AbilityType[this.type]+" "+n+"</div>"},i}();e.PlayerHeroAbility=i}(bh||(bh={})),function(e){var t=function(){function t(e,t,r){void 0===r&&(r=0),this.player=e,this.item=t,this.count=r}return Object.defineProperty(t.prototype,"elementType",{get:function(){return this.item.elementType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guid",{get:function(){return this.item.guid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemType",{get:function(){return this.item.itemType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.item.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rarityType",{get:function(){return this.item.rarityType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCrystal",{get:function(){return t.isCrystal(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isEvoJar",{get:function(){return t.isEvoJar(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSandsOfTime",{get:function(){return t.isSandsOfTime(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRune",{get:function(){return t.isRune(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"needed",{get:function(){var t=this,r=0;if(this.isRune){var n=this.name.split("'")[0];this.player.filterHeroes(n).forEach(function(e){return r+=e.trait.maxMaterialCount||0}),this.player.filterActiveBattleCards(n,"Legendary").forEach(function(e){return r+=60*e.count})}else if(this.isCrystal)this.player.filterHeroes(e.ElementType[this.elementType]).forEach(function(e){return r+=(e.active.maxMaterialCount||0)+(e.passive.maxMaterialCount||0)}),this.player.filterActiveBattleCards(e.ElementType[this.elementType],"Legendary").forEach(function(e){return r+=60*e.count});else if(this.isSandsOfTime)this.player.activeBattleCards.forEach(function(e){return r+=e.maxMaxSotNeeded});else{this.player.activeRecipes.filter(function(e){return!!e.getItem(t)}).forEach(function(e){return r+=e.getMaxNeeded(t)})}return r},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowHtml",{get:function(){var t=this,n=e.ItemType[this.itemType].toLowerCase()+"s",a=this.isEvoJar?this.name.replace(/\W/g,""):this.isCrystal?this.name.split(/ /)[0]:e.data.HeroRepo.find(this.name.split("'")[0]).abilities[0].name.replace(/\W/g,""),i=e.getImg20(n,a),o=this.needed,u=o?" / "+e.utils.formatNumber(o):"",s='<span class="badge pull-right '+(o?this.count<o?"bg-danger":"bg-success":"")+'">'+e.utils.formatNumber(this.count)+u+"</span>",l="";if(o)if(this.isCrystal)this.player.filterHeroes(e.ElementType[this.elementType]).forEach(function(e){var r,n,a=e.active,i=e.passive;(r=a.maxMaterialCount)&&(l+=a.toRowHtml(r,t.count)),(n=i.maxMaterialCount)&&(l+=i.toRowHtml(n,t.count))}),this.player.filterActiveBattleCards(e.ElementType[this.elementType],"Legendary").forEach(function(r){var n=r.count*e.data.calcMaxCrystalsNeeded(r.playerCard,r.evoLevel);l+=r.toRowHtml(n,t.count)});else if(this.isRune){var c=this.name.split("'")[0];this.player.filterHeroes(c).forEach(function(e){var r,n=e.trait;(r=n.maxMaterialCount)&&(l+=n.toRowHtml(r,t.count))}),this.player.filterActiveBattleCards(c,"Legendary").forEach(function(r){var n=r.count*e.data.calcMaxRunesNeeded(r.playerCard,r.evoLevel);l+=r.toRowHtml(n,t.count)})}else if(this.isSandsOfTime)this.player.activeBattleCards.forEach(function(e){e.maxMaxSotNeeded;l+=e.toRowHtml(e.maxMaxSotNeeded,t.count)});else{this.player.activeRecipes.filter(function(e){var r=e.getItem(t);return r&&0!=r.max}).forEach(function(e){var r=e.getMaxNeeded(t);l+=e.card.toRowHtml(r,t.count)})}return'<div data-element-type="'+this.elementType+'" data-rarity-type="'+this.rarityType+'" data-item-type="'+this.itemType+'" data-hud="'+this.isSandsOfTime+'">'+r(this.guid,i+" "+this.name+" "+s,l)+"</div>"},enumerable:!0,configurable:!0}),t.isCrystal=function(t){return t&&t.itemType===e.ItemType.Crystal},t.isEvoJar=function(t){return t&&t.itemType===e.ItemType.EvoJar},t.isSandsOfTime=function(e){return e&&"Sands of Time"===e.name},t.isRune=function(t){return t&&t.itemType===e.ItemType.Rune},t.toRowHtml=function(r,n,a){var i=e.ItemType[r.itemType].toLowerCase()+"s",o=t.isEvoJar(r)?r.name.replace(/\W/g,""):t.isCrystal(r)?r.name.split(/ /)[0]:e.data.HeroRepo.find(r.name.split("'")[0]).abilities[0].name.replace(/\W/g,""),u=e.getImg20(i,o),s='<span class="badge pull-right '+(n<a?"bg-danger":"bg-success")+'">'+e.utils.formatNumber(n)+" / "+e.utils.formatNumber(a)+"</span>";return"<div>"+u+" "+r.name+" "+s+"</div>"},t}();function r(e,t,r){return r?"<div>"+t+" "+('<button class="bs-btn bs-btn-link bs-btn-xs brain-hud-button" type="button" data-action="toggle-child" data-guid="'+e+'">[+]</button>')+"</div>"+('<div class="brain-hud-child-scroller" data-parent-guid="'+e+'">'+r+"</div>"):"<div>"+t+"</div>"}e.PlayerInventoryItem=t,e.renderExpandable=r}(bh||(bh={})),function(e){var t=function(){function t(t,r){this.player=t,this.type="WildCard",this._=e.data.WildCardRepo.find(r)}return Object.defineProperty(t.prototype,"count",{get:function(){return this.player._pp&&this.player._pp.wildcards[this.guid]||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guid",{get:function(){return this._.guid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"html",{get:function(){var t=this.needed,r=t?" / "+e.utils.formatNumber(t):"",n='<span class="badge pull-right '+(t?this.count<t?"bg-danger":"bg-success":"")+'">'+this.count+r+"</span>";return e.getImg("cardtypes","WildCard")+" "+this.name+" WC "+n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"needed",{get:function(){var t=0;return this.player.filterActiveBattleCards(e.RarityType[this.rarityType]).forEach(function(e){return t+=e.maxWildCardsNeeded}),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rarityType",{get:function(){return e.RarityType[this._.name.replace(/ /g,"")]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowHtml",{get:function(){var t=this,r=this.html,n="",a="";return this.needed&&(n='<button class="bs-btn bs-btn-link bs-btn-xs brain-hud-button" type="button" data-action="toggle-child" data-guid="'+this.guid+'">[+]</button>',a='<div class="brain-hud-child-scroller" data-parent-guid="'+this.guid+'">',this.player.filterActiveBattleCards(e.RarityType[this.rarityType]).forEach(function(e){return a+=e.toRowHtml(e.maxWildCardsNeeded,t.count)}),a+="</div>"),'<div data-type="'+this.type+'" data-rarity-type="'+this.rarityType+'"><div>'+r+" "+n+"</div>"+a+"</div>"},enumerable:!0,configurable:!0}),t.toRowHtml=function(t,r,n){var a=e.getImg20("cardtypes","WildCard"),i='<span class="badge pull-right '+(r<n?"bg-danger":"bg-success")+'">'+e.utils.formatNumber(r)+" / "+e.utils.formatNumber(n)+"</span>";return"<div>"+a+" "+t.name+" WC "+i+"</div>"},t}();e.PlayerWildCard=t}(bh||(bh={})),function(e){var t,r,n={Common:1,Uncommon:2,Rare:3,SuperRare:4,Legendary:5},a={Common:10,Uncommon:20,Rare:35,SuperRare:50,Legendary:50};(r=t=e.MinMaxType||(e.MinMaxType={}))[r.Min=0]="Min",r[r.Max=1]="Max";var i=function(){function r(){}return r.rateMaxedHero=function(t,n){return void 0===n&&(n=e.RarityType.Legendary),("Jinx"==t.name?45:55)*(20*(n+1)/100)+r.rateMaxedDeck(t,n)},r.rateMaxedDeck=function(n,a){void 0===a&&(a=e.RarityType.Legendary);var i=[];return e.Hero.filterCardsByHero(n,e.data.BattleCardRepo.all).filter(function(e){return e.rarityType<=a}).map(function(e){return{card:e,powerRating:r.rateBattleCard(e,t.Max)}}).sort(function(e,t){return e.powerRating==t.powerRating?0:e.powerRating<t.powerRating?1:-1}).forEach(function(t){var r=i.find(function(e){return e.card.name==t.card.name});r?r.card.rarityType==e.RarityType.SuperRare&&t.card.rarityType==e.RarityType.Legendary&&(i=i.filter(function(e){return e!=r})).push(t):i.length<4&&i.push(t)}),i.reduce(function(e,t){return e+2*t.powerRating},0)},r.rateDeck=function(t){t.reduce(function(e,t){return e[t.playerCard.configId]=r.ratePlayerCard(t.playerCard),e},{});var n=t.filter(function(t){return e.BattleCardRepo.isCycleCard(t,t.evo)});n.length,t.filter(function(e){return!n.includes(e)});return t.reduce(function(e,t){return e+r.ratePlayerCard(t.playerCard)*t.count},0)},r.rateBattleCard=function(i,o){var u=e.RarityType[i.rarityType],s=o==t.Max?n[u]:0,l=o==t.Max?a[u]:0;return r.ratePlayerCard({configId:i.guid,evolutionLevel:s,level:l-1})},r.rateAndSort=function(e,n){void 0===n&&(n=t.Max);var a=e.map(function(e){return{card:e,powerRating:r.rateBattleCard(e,n)}});return a.sort(function(e,t){return t.powerRating-e.powerRating}),a},r.ratePlayerCard=function(t){return function(t){if(!t)return 0;var r=e.data.BattleCardRepo.find(t.configId);if(!r)return 0;var n=t.evolutionLevel,a=t.level,i=(e.BattleCardRepo.getPerk(r,n),r.typesTargets.map(function(t){return e.PlayerBattleCard.parseTarget(t)})),o=e.GameEffect.parseAll(t),u=0;return i.forEach(function(t,i){return u+=function(t,r,n,a){if(!t)return 0;var i=e.BattleCardRepo.calculateValue({configId:t.guid,evolutionLevel:n,level:a}),o=e.BattleCardRepo.getPerk(t,n)/100,u=(e.GameEffect.parse(t.effects.find(function(e){return"Regen"==e}))||{turns:1}).turns,s=t.perks.includes("Critical")?1.5*o:1,l=e.PlayerBattleCard.parseTarget(t.typesTargets[r]),c=Math.round(i*s*l.targetMultiplier*u);return l.flurry&&(c=c/l.flurryCount*l.flurryHitMultiplier*l.flurryCount),c||console.log(t.name,[t,r,n,a,i,o,s,l,c]),c}(r,i,n,a)/t.typeDivisor}),o.forEach(function(e){return u+=e.powerRating}),u/=r.turns,Math.round(100*u)}(t)},r.ratePlayerHeroAbility=function(t){return"Jinx"==t.hero.name&&t.heroAbility.type==e.AbilityType.Passive?0:(t.type==e.AbilityType.Trait?2:t.type==e.AbilityType.Active?1.5:1)*Math.round(1e3*t.level/t.levelMax)/100},r.ratePlayerHeroHitPoints=function(t){var r=e.HeroRepo.MaxLevel,n=e.data.HeroRepo.all.map(function(t){return[e.Hero.getHitPoints(t,r),t]}).sort().pop()[0],a=e.Hero.getHitPoints(t.hero,r)/n,i=t.level/r;return Math.round(1e3*a*i)/100},r}();e.PowerRating=i}(bh||(bh={})),function(e){var t=function(t){function r(r,n){void 0===n&&(n=!1);var a=t.call(this)||this;a.card=r,a.evos=[];var i=(r&&r.mats||[]).map(function(t){return e.data.ItemRepo.find(t.trim())}).filter(function(e){return!!e}).sort(e.utils.sort.byRarity);return[0,1,2,3,4].slice(0,r.rarityType+1).slice(n?r.evo:0).forEach(function(t){var n=e.ItemRepo.sandsOfTime;a.addItem(t,e.data.getMinSotNeeded(r.rarityType,t),e.data.getMaxSotNeeded(r.rarityType,t),n.name),i.forEach(function(n){a.addItem(t,0,e.data.getMaxMatNeeded(r.rarityType,t,n.rarityType),n.name)})}),a}return __extends(r,t),Object.defineProperty(r.prototype,"lower",{get:function(){return this.card.lower},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"name",{get:function(){return this.card.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rarityType",{get:function(){return this.card.rarityType},enumerable:!0,configurable:!0}),r.prototype.addItem=function(t,r,n,a){var i=this.evos[t]||(this.evos[t]={evoFrom:t,evoTo:t+1,items:[]}),o={item:e.data.ItemRepo.find(a),min:r,max:n};i.items.push(o)},Object.defineProperty(r.prototype,"common",{get:function(){var t=this;return this.fromCache("common",function(){var r=t.all.find(function(t){return t.item.rarityType==e.RarityType.Common});return r&&r.item})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"uncommon",{get:function(){var t=this;return this.fromCache("uncommon",function(){var r=t.all.find(function(t){return t.item.rarityType==e.RarityType.Uncommon&&"Sands of Time"!=t.item.name});return r&&r.item})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rare",{get:function(){var t=this;return this.fromCache("rare",function(){var r=t.all.find(function(t){return t.item.rarityType==e.RarityType.Rare});return r&&r.item})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"superRare",{get:function(){var t=this;return this.fromCache("superRare",function(){var r=t.all.find(function(t){return t.item.rarityType==e.RarityType.SuperRare});return r&&r.item})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inventoryItems",{get:function(){return[this.common,this.uncommon,this.rare,this.superRare]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"all",{get:function(){var e=this;return this.fromCache("recipeItems",function(){var t=[];return e.evos.forEach(function(e){e.items.forEach(function(e){var r=t.find(function(t){return t.item==e.item});r||t.push(r={item:e.item,min:0,max:0}),r.min+=e.min,r.max+=e.max})}),t})},enumerable:!0,configurable:!0}),r.prototype.getItem=function(e){return this.all.find(function(t){return t.item.name==e.name})},r.prototype.getMaxNeeded=function(t){var r=this.getItem(t);return(r&&r.max)*(this.card instanceof e.PlayerBattleCard?this.card.count:1)},r}(e.Cacheable);e.Recipe=t}(bh||(bh={})),function(e){var t=function(){function t(e,r,n){void 0===e&&(e=""),void 0===r&&(r=0),void 0===n&&(n=!1),this.id=e,this.gid=r,this.cacheable=n,t.AllRepos.push(this)}return t.prototype.init=function(){var r=this;return this._init||(this._init=new Promise(function(n){var a=(e.TSV||{})[String(r.gid||r.id)];if(!a&&r.cacheable)try{var i=JSON.parse(e.utils.getFromStorage(r.id+"-"+r.gid)||null);i&&i.date&&(new Date).getTime()<i.date+864e5&&(a=i.tsv||null)}catch(e){}a?r.resolveTsv(a,n):"number"==typeof r.gid?t.fetchTsv(r.id,r.gid).then(function(e){return r.resolveTsv(e,n)},function(){return r.unresolveTsv()}):n(r.data=[])})),this._init},t.prototype.resolveTsv=function(t,r){var n=this;if(this.cacheable)try{e.utils.setToStorage(this.id+"-"+this.gid,JSON.stringify({tsv:t,date:(new Date).getTime()}))}catch(e){}var a=this.parseTsv(t);a instanceof Promise?a.then(function(e){return r(e)},function(){return n.unresolveTsv()}):r(a)},t.prototype.unresolveTsv=function(){this.data=[]},t.prototype.parseTsv=function(e){return this.data=t.mapTsv(e)},Object.defineProperty(t.prototype,"all",{get:function(){return this.data.slice()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allSortedByName",{get:function(){return this.sortedByName||(this.sortedByName=this.all.sort(e.utils.sort.byName)),this.sortedByName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this.data.length},enumerable:!0,configurable:!0}),t.prototype.find=function(e){var t=e.toLowerCase();return this.data.find(function(r){return r.guid==e||r.name==e||r.lower==t})},t.prototype.put=function(e){var t=this.data.findIndex(function(t){return t.guid==e.guid});-1<t?this.data[t]=e:this.data.push(e)},t.fetchTsv=function(t,r){var n="number"==typeof r?t:null,a="number"==typeof r?r:t;return(e.TSV||{})[String(a)]?Promise.resolve(e.TSV[String(a)]):XmlHttpRequest.get(e.host+"/tsv.php?gid="+a+(n?"&id="+n:""))},t.mapTsv=function(t){var r=t.split(/\n/),n=r.shift().split(/\t/).map(function(e){return e.trim()});return r.filter(function(e){return!!e.trim().length}).map(function(t){var r=t.split(/\t/).map(function(e){return e.trim()}),a={};return n.forEach(function(t,n){var i=r[n];switch(t){case"elementTypes":case"crystalElementTypes":case"boosterElementTypes":a[t]=i.split(",").filter(function(e){return!!e}).map(function(t){return e.ElementRepo.findType(t)});break;case"element":case"elementType":a.elementType=e.ElementRepo.findType(i);break;case"rarity":case"rarityType":a.rarityType=e.RarityRepo.findType(i);break;case"klass":case"klassType":a.klassType=e.KlassRepo.findType(i);break;case"itemType":a.itemType=e.ItemRepo.findType(i);break;case"abilityType":a.abilityType=e.AbilityRepo.findType(i);break;case"brag":case"packs":a[t]=e.utils.parseBoolean(i);break;case"randomMats":a[t]=i.split(",").map(function(e){return+e});break;case"boosterRarities":case"minValues":a[t]=i.split("|").map(function(e){return e.split(",").map(function(e){return+e})});break;case"maxValues":a[t]=i.split("|").map(function(e){return+e});break;case"typesTargets":a[t]=i.split("|").filter(function(e){return!!e});break;case"runeHeroes":case"effects":case"mats":case"perks":a[t]=i.split(",").filter(function(e){return!!e});break;case"keys":case"fame":case"gold":case"perkBase":case"turns":a[t]=+i;break;case"name":a.lower=i.toLowerCase(),a[t]=(i||"").trim();break;default:a[t]=(i||"").trim()}}),a})},t.init=function(){return t.AllRepos.map(function(e){return e.init()})},t.AllRepos=[],t}();e.Repo=t}(bh||(bh={})),function(e){var t=function(){function t(){}return Object.defineProperty(t,"allTypes",{get:function(){return[0,1,2]},enumerable:!0,configurable:!0}),t.isAbility=function(t){return String(t).replace(/ /g,"")in e.AbilityType},t.findType=function(t){return this.allTypes.find(function(r){return t[0]==e.AbilityType[r][0]})},t}();e.AbilityRepo=t}(bh||(bh={}));var _allHastes=[];!function(e){var t=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return __extends(r,t),r.isCycleCard=function(t,n){return!!t&&(void 0===n&&(n=t.rarityType+1),t.effects.concat(t.perks).filter(function(e){return e.toLowerCase().includes("haste")||e.toLowerCase().includes("speed")}).forEach(function(r){return _allHastes.push(t.name+" ("+e.RarityType[t.rarityType][0]+"): "+r)}),1==t.turns&&(!!t.effects.find(function(e){return"Haste 1T"==e})||!(!t.perks.find(function(e){return"Haste 1T"==e})||100!=r.getPerk(t,n))))},r.getPerk=function(e,t){return e?Math.min(100,e.perkBase+r.AddedPerkPerEvo*t):0},r.getMaxPerk=function(e){return e?r.getPerk(e,1+e.rarityType):0},r.calculateValue=function(t,r){if(!t)return 0;void 0===r&&(r=0);var n=e.data.BattleCardRepo.find(t.configId);if(!n)return 0;var a=n.minValues[r][t.evolutionLevel],i=n.minValues[r].slice().pop(),o=(n.maxValues[r]-i)/(e.BattleCardRepo.getLevelsForRarity(n.rarityType)-1);return Math.floor(a+o*t.level)},r.getLevelsForRarity=function(e){return[10,20,35,50,50][e]},r.isMaxLevel=function(t,n){return n==r.getLevelsForRarity(e.RarityRepo.findType(t))},r.getXpDeltaFromLevel=function(e){return e?36*(e-1)+100:0},r.getXpForLevel=function(e){for(var t=0,n=1;n<e;n++)t+=r.getXpDeltaFromLevel(n);return t},r.getXpValue=function(t){switch(t.rarityType){case e.RarityType.Common:return 400;case e.RarityType.Uncommon:return 700;case e.RarityType.Rare:return 1200;case e.RarityType.SuperRare:case e.RarityType.Legendary:default:return 0}},r.AddedPerkPerEvo=10,r}(e.Repo);e.BattleCardRepo=t}(bh||(bh={})),function(e){var t=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return __extends(r,t),r.getXpValue=function(t,r){void 0===r&&(r=!1);var n=r?1.5:1;switch(t.rarityType){case e.RarityType.Common:return 120*n;case e.RarityType.Uncommon:return 220*n;case e.RarityType.Rare:return 350*n;case e.RarityType.SuperRare:return 700*n;default:return 0}},r}(e.Repo);e.BoosterCardRepo=t}(bh||(bh={})),function(e){var t=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.parseTsv=function(t){var r=e.Repo.mapTsv(t);return r.forEach(function(e){e.guid=e.lower.replace(/\W/g,"-"),Array.isArray(e.crystals)||(e.crystals=String(e.crystals).split(",").filter(function(e){return!!e})),Array.isArray(e.mats)||(e.mats=String(e.mats).split(",").filter(function(e){return!!e})),Array.isArray(e.runes)||(e.runes=String(e.runes).split(",").filter(function(e){return!!e}))}),this.data=r.map(function(t){return new e.Dungeon(t)})},n.prototype.findDungeonFor=function(e){return this.all.filter(function(t){return!!t.findDrop(e)})},n.prototype.getDropRates=function(e){return this.all.map(function(t){return t.findDrop(e)}).filter(function(e){return!!e}).sort(r).reverse()},n}(e.Repo);function r(e,t){var r=e.dropRate.averagePerKey,n=t.dropRate.averagePerKey;if(r!=n)return r<n?-1:1;var a=e.dungeon.keys,i=t.dungeon.keys;if(a!=i)return a<i?1:-1;var o="Normal"==e.dungeon.difficulty?0:"Elite"==e.dungeon.difficulty?1:2,u="Normal"==t.dungeon.difficulty?0:"Elite"==t.dungeon.difficulty?1:2;return o!=u?o<u?1:-1:0}e.DungeonRepo=t}(bh||(bh={})),function(e){var t=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.parseTsv=function(t){return this.data=e.Repo.mapTsv(t),this.data.forEach(function(e){return e.guid=e.lower.replace(/\W/g,"-")}),this.data},n.prototype.find=function(e){var t=e.toLowerCase();return this.data.find(function(e){return e.lower==t||(e.alt||"").toLowerCase()==t})},n.mapEffects=function(e){var t=[];return e.effects.forEach(function(e){r(e).forEach(function(e){t.includes(e)||t.push(e)})}),t},n.mapPerks=function(e){var t=[];return e.perks.forEach(function(e){r(e).forEach(function(e){t.includes(e)||t.push(e)})}),t},n.mapTargets=function(e){var t=[];return e.typesTargets.forEach(function(e){r(e).forEach(function(e){t.includes(e)||t.push(e)})}),t},n.toImage=function(t,r){return void 0===r&&(r=e.getImg20),["Self","Single"].includes(t.name)?"":r("effects",t.name.replace(/\W/g,""))},n.toImageSrc=function(t){return["Self","Single"].includes(t.name)?"":e.getSrc("effects",t.name.replace(/\W/g,""))},n}(e.Repo);function r(t){var r=e.GameEffect.parse(t),n=r&&e.data.EffectRepo.find(r.effect)||null,a=n?[n]:[];return r&&(r.raw.includes("All Allies")&&a.push(e.data.EffectRepo.find("Multi-Target (Ally)")),r.raw.includes("All Enemies")&&a.push(e.data.EffectRepo.find("Multi-Target (Enemy)")),r.raw.includes("Flurry")&&a.push(e.data.EffectRepo.find("Flurry"))),a}e.EffectRepo=t}(bh||(bh={})),function(e){var t=function(){function t(){}return Object.defineProperty(t,"allTypes",{get:function(){return[0,1,2,3,4,5]},enumerable:!0,configurable:!0}),t.toImage=function(t,r){return void 0===r&&(r=e.getImg20),t==e.ElementType.Neutral?"":r("elements",e.ElementType[t])},t.toImageSrc=function(t){return e.getSrc("elements",e.ElementType[t])},t.isElement=function(t){return String(t)in e.ElementType},t.findType=function(t){var r=this.allTypes.find(function(r){return t[0]==e.ElementType[r][0]});return null===r&&console.log(t),r},t}();e.ElementRepo=t}(bh||(bh={})),function(e){var t=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return __extends(r,t),r.prototype.parseTsv=function(t){var r=this;return new Promise(function(n){for(var a=e.Repo.mapTsv(t),i=[];a.length;)i.push(new e.Hero([a.shift(),a.shift(),a.shift()]));n(r.data=i)})},r.prototype.filterByElement=function(t){return this.data.filter(function(r){return r.elementType===t||e.ElementType[r.elementType]===t})},Object.defineProperty(r.prototype,"sorted",{get:function(){return this._sorted||(this._sorted=this.data.slice().sort(e.utils.sort.byElementThenKlass)),this._sorted},enumerable:!0,configurable:!0}),r.prototype.sortBy=function(e){return e?this.data.slice().sort(e):this.sorted},r.toImageSrc=function(t){return e.getSrc("heroes",t.name)},r.getMaxLevel=function(e){return 2*e},r.getMaxTrait=function(e){return Math.max(e-1,0)},r.getMaxActive=function(e,t){return"Jinx"==e.name?Math.max(t-29,0):Math.max(t-14,0)},r.getMaxPassive=function(e,t){return"Jinx"==e.name?Math.max(t-14,0):Math.max(t-29,0)},r.getAbilityLevelCap=function(t){switch(t.type){case e.AbilityType.Active:return r.getMaxActive(t.hero,t.playerHero.level);case e.AbilityType.Passive:return r.getMaxPassive(t.hero,t.playerHero.level);case e.AbilityType.Trait:return r.getMaxTrait(t.playerHero.level)}},r.getAbilityLevelMax=function(t){switch(t.type){case e.AbilityType.Active:return r.getMaxActive(t.hero,r.MaxLevel);case e.AbilityType.Passive:return r.getMaxPassive(t.hero,r.MaxLevel);case e.AbilityType.Trait:return r.getMaxTrait(r.MaxLevel)}},Object.defineProperty(r,"MaxHeroCount",{get:function(){return MaxHeroCount},enumerable:!0,configurable:!0}),Object.defineProperty(r,"MaxFame",{get:function(){return MaxFameLevel},enumerable:!0,configurable:!0}),Object.defineProperty(r,"MaxLevel",{get:function(){return r.getMaxLevel(r.MaxFame)},enumerable:!0,configurable:!0}),Object.defineProperty(r,"MaxCompletionLevel",{get:function(){var e=r.MaxLevel,t={};return e+r.getMaxTrait(e)+r.getMaxActive(t,e)+r.getMaxPassive(t,e)},enumerable:!0,configurable:!0}),r.getAbilityMaxLevel=function(t,n){switch(n){case e.AbilityType.Active:return r.getMaxActive(t,r.MaxLevel);case e.AbilityType.Passive:return r.getMaxPassive(t,r.MaxLevel);case e.AbilityType.Trait:return r.getMaxTrait(r.MaxLevel)}},r.getLockedArchetype=function(e,t){return{playerId:e,id:t,experience:0,level:0,version:0,abilityLevels:{},deck:[],locked:!0}},r}(e.Repo);e.HeroRepo=t}(bh||(bh={})),function(e){var t=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return __extends(r,t),Object.defineProperty(r.prototype,"evoJars",{get:function(){return this.data.filter(function(t){return t.itemType===e.ItemType.EvoJar})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"crystals",{get:function(){return this.data.filter(function(t){return t.itemType===e.ItemType.Crystal})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"runes",{get:function(){return this.data.filter(function(t){return t.itemType===e.ItemType.Rune})},enumerable:!0,configurable:!0}),r.getValue=function(t,r){return t==e.ItemType.Crystal?1e3:t==e.ItemType.Rune?2e3:[300,800,1500,3e3][r]},Object.defineProperty(r,"sandsOfTime",{get:function(){return e.data.ItemRepo.find("Sands of Time")},enumerable:!0,configurable:!0}),r.toImage=function(t,r){return void 0===r&&(r=e.getImg20),r(e.ItemType[t.itemType].toLowerCase()+"s",t.itemType==e.ItemType.EvoJar?t.name.replace(/\W/g,""):t.itemType==e.ItemType.Crystal?t.name.split(/ /)[0]:e.data.HeroRepo.find(t.name.split("'")[0]).abilities[0].name.replace(/\W/g,""))},r.toImageSrc=function(t){var r=e.ItemType[t.itemType].toLowerCase()+"s",n=t.itemType==e.ItemType.EvoJar?t.name.replace(/\W/g,""):t.itemType==e.ItemType.Crystal?t.name.split(/ /)[0]:e.data.HeroRepo.find(t.name.split("'")[0]).abilities[0].name.replace(/\W/g,"");return e.getSrc(r,n)},Object.defineProperty(r,"allTypes",{get:function(){return[0,1,2]},enumerable:!0,configurable:!0}),r.findType=function(t){return this.allTypes.find(function(r){return t[0]==e.ItemType[r][0]})},r}(e.Repo);e.ItemRepo=t}(bh||(bh={})),function(e){var t=function(){function t(){}return Object.defineProperty(t,"allTypes",{get:function(){return[0,1,2]},enumerable:!0,configurable:!0}),t.toImage=function(t,r){return void 0===r&&(r=e.getImg20),r("classes",e.KlassType[t])},t.toImageSrc=function(t){return e.getSrc("classes",e.KlassType[t])},t.findType=function(t){return this.allTypes.find(function(r){return t.slice(0,2)==e.KlassType[r].slice(0,2)})},t}();e.KlassRepo=t}(bh||(bh={})),function(e){var t=function(){function t(){}return Object.defineProperty(t,"allTypes",{get:function(){return[0,1,2,3,4]},enumerable:!0,configurable:!0}),t.isRarity=function(t){return String(t).replace(/ /g,"")in e.RarityType},t.findType=function(t){return this.allTypes.find(function(r){return t[0]==e.RarityType[r][0]})},t}();e.RarityRepo=t}(bh||(bh={}));var bh,DataSheetID="1203v6egra6rDQShMdklVHQrPa7lfP6RaSCcqdATIEIo",BattleCardRepoGID=1013492615,BoosterCardRepoGID=1070164839,DungeonRepoGID=1980099142,EffectRepoGID=1091073205,HeroRepoGID=1755919442,ItemRepoGID=1250310062,WildCardRepoGID=2106503523,GuildsGID=496437953,USE_CACHE=!0,NO_CACHE=!1,MaxHeroCount=13,MaxFameLevel=45,AttackDivisor=750,ShieldDivisor=1500,HealDivisor=1500,BattleCardDataUrl="https://docs.google.com/spreadsheets/d/e/2PACX-1vQgpt5tf178r4MJku64wjcQyK-py5KTwbeoePP4vnFQ0gEJWowglA-cGHLSQtVbpp7kb_07gLbZP1N_/pub?output=tsv",DungeonDataUrl="https://docs.google.com/spreadsheets/d/e/2PACX-1vRCyjBTeKjsBri_uvkFnT-i9f-jI4RUR0YffYh32XFtQfywivXktmLcmGOuXTfOQZH1sv6VTmF9Ceee/pub?gid=1815567292&single=true&output=tsv";function numToRoman(e){switch(+e){case 1:return"I";case 2:return"II";case 3:return"III";case 4:return"IV";case 5:return"V";case 6:return"VI";case 7:return"VII";case 8:return"VIII";case 9:return"IX";case 10:return"X"}}function updateDungeonData(){$.get(DungeonDataUrl).then(function(e){var t=bh.Repo.mapTsv(e),r=Object.keys(t[0]),n=t.map(function(e){var t=e.Dungeon+" "+e.Difficulty+" "+numToRoman(e.Level),r=bh.data.DungeonRepo.find(t).data;return r||((r={}).guid=t.replace(/\W/g,"-"),r.name=t,r.dungeon=e.Dungeon,r.difficulty=e.Difficulty,r.act=numToRoman(e.Level),r.keys=-1,r.fame=-1,r.gold=-1,r.elementTypes=[],r.crystals=[],r.runes=[],r.mats=[],r.randomMats=[],r.boosterElementTypes=[],r.boosterRarities=[]),r.keys=+e.Keys,r.crystals=bh.data.ItemRepo.crystals.filter(function(t){return!!e[t.name]}).map(function(t){return t.name.split(/\W/)[0]+"|"+e[t.name].replace(/\s+/g,"").replace(",","|")}),r.mats=bh.data.ItemRepo.evoJars.filter(function(t){return!!e[t.name]}).map(function(t){return t.name+"|"+e[t.name].replace(/\s+/g,"").replace(",","|")}),r.runes=bh.data.ItemRepo.runes.filter(function(t){return!!e[t.name.startsWith("Hawk")?"Hawkeye Air Rune":t.name]}).map(function(t){return t.name.split(/\W/)[0]+"|"+e[t.name.startsWith("Hawk")?"Hawkeye Air Rune":t.name].replace(/\s+/g,"").replace(",","|")}),r});bh.data.ItemRepo.all.filter(function(e){return!r.includes(e.name)}).forEach(function(e){return console.log(e.name)});var a="guid\tname\tdungeon\tdifficulty\tact\tkeys\tfame\tgold\telementTypes\tcrystals\trunes\tmats\trandomMats\tboosterElementTypes\tboosterRarities";n.forEach(function(e){a+="\n"+e.guid+"\t"+e.name+"\t"+e.dungeon+"\t"+e.difficulty+"\t"+e.act+"\t"+e.keys+"\t"+e.fame+"\t"+e.gold+"\t"+e.elementTypes+"\t"+e.crystals+"\t"+e.runes+"\t"+e.mats+"\t"+e.randomMats+"\t"+e.boosterElementTypes+"\t"+e.boosterRarities}),$("#data-output").val(a)})}!function(e){!function(t){function r(e){var t=[];return Array.isArray(e)&&e.length>0&&e.forEach(function(e){var r=e[(Object.keys(e)||[])[0]||"0"],a=r[(Object.keys(r)||[])[0]||""]||null;n(a)&&t.push(a)}),t}function n(e){return e&&e.id&&e.firstPlayedVersion&&!0}function a(e){return!!(e&&e.playerId&&e.archetypeLevels)}var i;t.BattleCardRepo=new e.BattleCardRepo(DataSheetID,BattleCardRepoGID,NO_CACHE),t.BoosterCardRepo=new e.BoosterCardRepo(DataSheetID,BoosterCardRepoGID,USE_CACHE),t.DungeonRepo=new e.DungeonRepo(DataSheetID,DungeonRepoGID,NO_CACHE),t.EffectRepo=new e.EffectRepo(DataSheetID,EffectRepoGID,NO_CACHE),t.HeroRepo=new e.HeroRepo(DataSheetID,HeroRepoGID,USE_CACHE),t.ItemRepo=new e.ItemRepo(DataSheetID,ItemRepoGID,USE_CACHE),t.PlayerRepo=new e.Repo,t.WildCardRepo=new e.Repo(DataSheetID,WildCardRepoGID,USE_CACHE),t.arenaToPlayers=r,t.isGuildWar=function(e){return e&&e.guilds&&e.currentWar&&!0},t.isGuild=function(e){return e&&e.playerGuild&&e.members&&!0},t.isArena=function(e){return r(e).length&&!0},t.isPlayer=n,t.isGuildMembers=function(e){return e&&Array.isArray(e)&&!e.map(a).includes(!1)},t.isGuildPlayer=a,t.init=function(){return i||(i=Promise.all([t.guilds.init()].concat(e.Repo.init()))),i}}(e.data||(e.data={}))}(bh||(bh={})),function(e){!function(t){function r(e){return e+1}function n(e,t){return[[1],[1,2],[1,2,4],[1,2,4,5],[1,2,3,4,5]][e||0][t||0]}function a(e,t){return[[1e3],[3700,11300],[4200,19200,49e3],[25e3,44e3,7e4,155e3],[45e3,9e4,18e4,36e4,54e4]][e][t]}function i(t,r){var n=a(t,r),i=e.ItemRepo.sandsOfTime;return n+u(t,r)*e.ItemRepo.getValue(i.itemType,i.rarityType)+[0,1,2,3].map(function(e){return s(t,r,e)}).map(function(t,r){return t*e.ItemRepo.getValue(e.ItemType.EvoJar,r)}).reduce(function(e,t){return e+t},0)+c(t,r)*e.ItemRepo.getValue(e.ItemType.Rune,e.RarityType.Rare)+l(t,r)*e.ItemRepo.getValue(e.ItemType.Crystal,e.RarityType.Uncommon)}function o(e,t){return[[0],[2,5],[5,10,20],[10,20,30,40],[20,30,40,60,60]][e||0][t||0]}function u(e,t){return[[10],[12,15],[15,20,30],[20,30,40,60],[30,40,60,80,100]][e||0][t||0]}function s(e,t,r){return([[[12]],[[12,2],[12,6,2]],[[14,2],[26,10,4],[,14,8,6]],[[26,6,2],[40,20,12],[,26,16,8],[,26,20,12]],[[40,20,12],[,26,16,8],[,30,24,12],[,36,30,16]]][e][t]||[])[r]||0}function l(t,r){return t==e.RarityType.Legendary&&4==r?60:0}function c(t,r){return t==e.RarityType.Legendary&&4==r?60:0}t.getMaxEvo=r,t.evoMultiplier=function(e){return[.8,.85,.88,.9,1][e]},t.wildsForEvo=n,t.getNextWildCardsNeeded=function(e){return n(e.rarityType,e.evo)},t.getMaxWildCardsNeeded=function(e){for(var t=r(e.rarityType),a=0,i=e.evo;i<t;i++)a+=n(e.rarityType,i);return a},t.getBaseGoldNeeded=a,t.getMinGoldNeeded=function(t,r){var n=e.ItemRepo.sandsOfTime;return a(t,r)+o(t,r)*e.ItemRepo.getValue(n.itemType,n.rarityType)},t.getMaxGoldNeeded=i,t.calcMaxGoldNeeded=function(e,n){for(var a=0,o=(t.BattleCardRepo.find(e.configId)||{}).rarityType||0,u=r(o),s=+n.split(/\./)[0];s<u;s++)a+=i(o,s);return a},t.getMinSotNeeded=o,t.getMaxSotNeeded=u,t.calcMaxSotNeeded=function(e,n){for(var a=0,i=(t.BattleCardRepo.find(e.configId)||{}).rarityType||0,o=r(i),s=+n.split(/\./)[0];s<o;s++)a+=u(i,s);return a},t.getMaxMatNeeded=s,t.getMinCrystalsNeeded=function(t,r){return t==e.RarityType.Legendary&&4==r?30:0},t.getMaxCrystalsNeeded=l,t.calcMaxCrystalsNeeded=function(e,n){for(var a=0,i=(t.BattleCardRepo.find(e.configId)||{}).rarityType||0,o=r(i),u=+n.split(/\./)[0];u<o;u++)a+=t.getMaxCrystalsNeeded(i,u);return a},t.getMinRunesNeeded=function(t,r){return t==e.RarityType.Legendary&&4==r?30:0},t.getMaxRunesNeeded=c,t.calcMaxRunesNeeded=function(e,n){for(var a=0,i=(t.BattleCardRepo.find(e.configId)||{}).rarityType||0,o=r(i),u=+n.split(/\./)[0];u<o;u++)a+=t.getMaxRunesNeeded(i,u);return a}}(e.data||(e.data={}))}(bh||(bh={})),function(e){var t;(function(r){var n,a=[],i=[];function o(e){return i.find(function(t){return t&&t.playerGuild&&t.playerGuild.id==e})}function u(e){var t=(e||"").toLowerCase();return a.filter(function(e){return e.lower==t})}function s(e){return a.filter(function(t){return t.guid==e})[0]||null}function l(r,n,u){if(n){var c=a.find(function(e){return e.guid==r});c?(c.lower=(n||"").toLowerCase(),c.name=n||"",c.parent=c.parent||u||null):a.push({guid:r,lower:(n||"").toLowerCase(),name:n||null,parent:u||null})}else if(Array.isArray(r)){var d=r[0].guildId,p=s(d),f=p&&o(p.guid);f?f.members=r:i.push({playerGuild:{members:r.map(function(e){return{playerId:e.playerId}}),id:d,name:p.name},members:r})}else{var y=r,g=y.playerGuild;if(g){l(g.id,g.name);var h=i.findIndex(function(e){return e.playerGuild.id==g.id});-1<h?i[h]=r:i.push(r),y.members.forEach(function(r){return t.PlayerRepo.put(new e.Player(r))})}}}function c(t){return a=e.Repo.mapTsv(t)}r.findByGuid=o,r.filterByName=function(e){return u(e).map(function(e){return o(e.guid)}).filter(function(e){return!!e})},r.filterNamesByName=u,r.filterNamesByParent=function(e){return e&&a.filter(function(t){return t.parent===e})||[]},r.findNameByGuid=s,r.getNames=function(){return a.slice()},r.updateLeaderBoard=function(e){e&&e.leaderboardEntries&&e.leaderboardEntries.forEach(function(e){var t=s(e.id);t||(l(e.id,e.name),t=s(e.id)),t.leaderBoardEntry=e})},r.put=l,r.init=function(){return n||(n=new Promise(function(t){var r=(e.TSV||{})[String(GuildsGID)];r?t(c(r)):e.Repo.fetchTsv(DataSheetID,GuildsGID).then(function(e){return t(c(e))},function(){return t(a)})})),n}})((t=e.data||(e.data={})).guilds||(t.guilds={}))}(bh||(bh={})),function(e){var t;(function(r){var n={};r.getReport=function(e){var t=l(e);return t[e]||(t=i(e)),t[e]||(t=u(e)),t[e]||(t=n),t};var a={};function i(e){return a[e]&&c(a[e].members)||{}}r.putGuild=function(e){return e&&e.playerGuild?(a[e.playerGuild.id]=e,i(e.playerGuild.id)):{}},r.getGuildReport=i;var o={};function u(e){return o[e]&&c(o[e])||{}}r.putGuildMembers=function(e){return o[e[0].guildId]=e.slice(),u(e[0].guildId)},r.getGuildMembersReport=u;var s={};function l(r){return s[r]&&function(r){t.HeroRepo.sorted;var n=r.guilds[0],a=r.guilds.find(function(e){return e.id!=n.id}),i=r.members[n.id].sort(e.utils.sort.byPositionThenName),o=r.members[a.id].sort(e.utils.sort.byPositionThenName),u=i.map(function(e,t){return c(t,e,o[t])}).join("\n"),s=o.map(function(e,t){return c(t,e,i[t])}).join("\n"),l={};return l[n.id]=u,l[a.id]=s,l;function c(e,t,n){var a=d(t,e),i=function(e,t){var r=e.currentWar.battles,n=0,a=0,i=0,o=0,u=0;return t&&r.forEach(function(e){e.initiator.playerId==t.playerId&&(e.initiator.winner?n++:a++,e.completedBragId&&o++,u+=e.initiator.totalScore),e.opponent.playerId==t.playerId&&(e.opponent.winner&&i++,u+=e.opponent.totalScore)}),{winCount:n,lossCount:a,dwCount:i,score:u,brags:o}}(r,t);return a+"\t"+i.winCount+"\t"+i.lossCount+"\t"+i.dwCount+"\t"+i.brags+"\t"+i.score}}(s[r])||{}}function c(r){t.HeroRepo.sorted;var n={};return n[r[0].guildId]=r.slice().sort(e.utils.sort.byPositionThenName).map(d).join("\n"),n}function d(r,n){var a=t.PlayerRepo.find(r.playerId),i=e.PositionType[r.position]+1,o=r.fameLevel+1,u=t.HeroRepo.sorted.map(a?function(t){var r=a.heroes.find(function(e){return t.guid==e.guid}),n=r?r.level:"/",i=r?e.utils.truncateNumber(r.hitPoints):"/",o=r&&r.isOp?"Y":" ",u=r?r.powerRating+" ":"/";return n+"|"+i+"|"+o+"|"+u}:function(t){var n=r.archetypeLevels[t.guid]+1,a=e.utils.truncateNumber(t.getHitPoints(n));return n?n+"|"+a+"|":"/|/|/|/"});return[n?n+1:"GL",o,r.name,i].concat(u).join("\t")}r.putGuildWar=function(e){return e.guilds.forEach(function(t){return s[t.id]=e}),l(e.guilds[0].id)},r.getGuildWarReport=l})((t=e.data||(e.data={})).reports||(t.reports={}))}(bh||(bh={})),function(e){!function(t){t.addCardTypes=function(t){void 0===t&&(t=e.$());var r=t("<style type='text/css' id='bh-hud-cardtypes'/>").appendTo(t("head"));r.append("div.bh-hud-image.img-Attack { background-image:url('"+e.getSrc("cardtypes","Attack")+"'); }"),r.append("div.bh-hud-image.img-Brag { background-image:url('"+e.getSrc("cardtypes","Brag")+"'); }"),r.append("div.bh-hud-image.img-BattleCard { background-image:url('"+e.getSrc("cardtypes","BattleCard")+"'); }"),r.append("div.bh-hud-image.img-Heal { background-image:url('"+e.getSrc("cardtypes","Heal")+"'); }"),r.append("div.bh-hud-image.img-Shield { background-image:url('"+e.getSrc("cardtypes","Shield")+"'); }"),r.append("div.bh-hud-image.img-WildCard { background-image:url('"+e.getSrc("cardtypes","WildCard")+"'); }")},t.addEffects=function(t){void 0===t&&(t=e.$());var r=t("<style type='text/css' id='bh-hud-effects'/>").appendTo(t("head"));e.data.EffectRepo.all.forEach(function(t){return r.append("div.bh-hud-image.img-"+t.guid+" { background-image:url('"+e.EffectRepo.toImageSrc(t)+"'); }")})},t.addElements=function(t){void 0===t&&(t=e.$());var r=t("<style type='text/css' id='bh-hud-elements'/>").appendTo(t("head"));e.ElementRepo.allTypes.forEach(function(t){return t==e.ElementType.Neutral?void 0:r.append("div.bh-hud-image.img-"+e.ElementType[t]+" { background-image:url('"+e.ElementRepo.toImageSrc(t)+"'); }")})},t.addHeroes=function(t){void 0===t&&(t=e.$());var r=t("<style type='text/css' id='bh-hud-heroes'/>").appendTo(t("head"));e.data.HeroRepo.all.forEach(function(t){return r.append("div.bh-hud-image.img-"+t.guid+" { background-image:url('"+e.HeroRepo.toImageSrc(t)+"'); }")})},t.addItems=function(t){void 0===t&&(t=e.$());var r=t("<style type='text/css' id='bh-hud-items'/>").appendTo(t("head"));e.data.ItemRepo.all.forEach(function(t){return r.append("div.bh-hud-image.img-"+t.guid+" { background-image:url('"+e.ItemRepo.toImageSrc(t)+"'); }")})},t.addKlasses=function(t){void 0===t&&(t=e.$());var r=t("<style type='text/css' id='bh-hud-klasses'/>").appendTo(t("head")),n=[16,12,12];e.KlassRepo.allTypes.forEach(function(t){return r.append("div.bh-hud-image.img-"+e.KlassType[t]+" { width:16px; background-size:"+n[t]+"px 20px; background-image:url('"+e.KlassRepo.toImageSrc(t)+"'); }")})}}(e.css||(e.css={}))}(bh||(bh={})),function(e){var t,r,n=[],a=!1,i=0;function o(e,r){if(!a)return++i>60?r("60 tries"):void(t&&t.jQuery&&t.document&&t.document.body?(t.jQuery(function(){n.forEach(function(e){return e()})}),e()):a||setTimeout(o,1500,e,r))}function u(){return s}e.loaded=function(e){return t=t||e,r||(r=new Promise(function(e,t){o(e,t),l(function(){e()})}))};var s={on:u,val:u};function l(e){return e?"function"!=typeof e||t&&t.jQuery?(t&&t.jQuery||u)(e):n.push(e):t&&t.jQuery||u}e.$=l,function(t){function r(e,t){e&&String(t).length&&l('.brain-hud-inventory-buttons > button[data-action="toggle-'+e+'"][data-'+e+'="'+t+'"]').toggleClass("active");var r=l('.brain-hud-inventory-buttons > [data-action="toggle-element"].active').toArray().map(function(e){return e.getAttribute("data-element")}),n=l('.brain-hud-inventory-buttons > [data-action="toggle-klass"].active').toArray().map(function(e){return e.getAttribute("data-klass")}),a=l('.brain-hud-inventory-buttons > [data-action="toggle-type"].active').toArray().map(function(e){return e.getAttribute("data-type")});l("#brain-hud-inventory-items-container > div").hide(),r.length||n.length||a.length?l("#brain-hud-inventory-items-container > div").each(function(e,t){var i=l(t),o=!r.length||r.includes(String(i.data("elementType"))),u=!n.length||n.includes(String(i.data("klassType")))||n.includes(i.data("brag")),s=!a.length||a.includes(i.data("type"))||a.includes(String(i.data("itemType")));o&&u&&s&&i.show()}):l('#brain-hud-inventory-items-container > div[data-hud="true"]').show()}function n(t){var n,a,i,o,u,s=l(t.target).closest("[data-action]"),c=s.data("action");switch(c){case"hud-to-library":e.library.openLibraryFromHud();break;case"sort-heroes":i=l("div.brain-hud-scouter-player"+(a?'[data-guid="'+a+'"]':".active")),u=(o=["element-klass","power-percent-asc","power-asc","hp-asc","name"])[o.indexOf(i.data("sort")||"element-klass")+1]||"element-klass",i.data("sort",u),a||(a=i.data("guid")),e.data.PlayerRepo.find(a).heroes.sort(function(t,r){var n,a;if("power-percent-asc"==u&&(n=t.powerPercent)!=(a=r.powerPercent))return n<a?-1:1;if("power-asc"==u&&(n=t.powerRating)!=(a=r.powerRating))return n<a?-1:1;if("hp-asc"==u){var i=t.hitPoints,o=r.hitPoints;if(i!=o)return i<o?-1:1}return"name"==u?e.utils.sort.byName(t,r):e.utils.sort.byElementThenKlass(t,r)}).forEach(function(e){return i.find('[data-guid="'+a+"-"+e.guid+'"]').appendTo(i)});break;case"refresh-guild":e.Messenger.instance.postMessage(e.Messenger.createMessage("refresh-guild",l("#brain-hud-scouter-guild-target").val()));break;case"refresh-player":e.Messenger.instance.postMessage(e.Messenger.createMessage("refresh-player",l("#brain-hud-scouter-player-target").val()));break;case"toggle-child":var d=l('div[data-parent-guid="'+(n=s.data("guid"))+'"]').toggleClass("active").hasClass("active");l('button[data-action="toggle-child"][data-guid="'+n+'"]').text(d?"[-]":"[+]");break;case"toggle-element":r("element",s.data("element"));break;case"toggle-klass":r("klass",s.data("klass"));break;case"toggle-type":r("type",s.data("type"));break;case"toggle-scouter-guild":e.hud.guild.selectGuildReport();break;case"toggle-scouter-player":e.hud.player.selectPlayerReport();break;case"toggle-scouter-hero":s.closest("[data-guid]").find(".brain-hud-scouter-panel-content").toggleClass("active");break;case"toggle-hud-bigger":e.hud.resize(!0);break;case"toggle-hud-smaller":e.hud.resize(!1);break;case"toggle-guild-scouter":var p=l("textarea#brain-hud-scouter-guild-report").toggleClass("active").hasClass("active");l('button.brain-hud-toggle[data-action="toggle-guild-scouter"]').text(p?"[-]":"[+]");break;case"toggle-player-scouter":p=l("div#brain-hud-scouter-player-report").toggleClass("active").hasClass("active");l('button.brain-hud-toggle[data-action="toggle-player-scouter"]').text(p?"[-]":"[+]");break;case"toggle-inventory":p=l("div.brain-hud-inventory-container").toggleClass("active").hasClass("active");l('button.brain-hud-toggle[data-action="toggle-inventory"]').text(p?"[-]":"[+]");break;default:console.log(c)}}t.init=function(){e.data.init().then(function(){l("body").on("click change","[data-action]",n)})},t.toggle=r}(e.events||(e.events={}))}(bh||(bh={})),function(e){var t;function r(e,t,r){var n="",a=t?'class="'+t+'"':"";r=r?'style="'+r+'"':"";return e.includes("glyphicons-82-refresh")&&(n="onerror=\"bh.$(this).replaceWith('&#8634;')\""),'<img src="'+e+'" '+a+" "+r+" "+n+"/>"}function n(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return t||(t=String(location.href).toLowerCase().includes("battlehand-hud/")?".":e.host),t+"/images/"+r.join("/")+".png"}e.getImg=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(n.apply(void 0,e))},e.getImg12=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(n.apply(void 0,e),"icon-12")},e.getImg20=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(n.apply(void 0,e),"icon-20")},e.getImgG=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(n.apply(void 0,e),"grayscale")},e.getSrc=n}(bh||(bh={})),function(e){var t;e.isHud=!1,e.isListener=!1,e.isLocal=!1,function(r){var n;function a(t){e.Messenger.isValidMessage(t)?i.forEach(function(e){if(e&&e.action==t.action&&e.callbackfn)try{e.callbackfn(t)}catch(e){console.error(t.action,e)}}):console.log("invalid message",t)}!function(e){var t,r,n=!1,a=!1,i=!1;function o(){i||n&&a&&(r(t),i=!0)}e.setResolve=function(e,n){t=e,r=n},e.resolveHud=function(){n=!0,o()},e.resolveListener=function(){a=!0,o()}}(n||(n={}));var i=[{action:"hud-init",url:null,callbackfn:n.resolveHud}];function o(){u(this)}function u(t){if(t.readyState==XmlHttpRequest.DONE){var r=t.requestUrl.match(/\?player=([a-z0-9]{8}(?:\-[a-z0-9]{4}){3}\-[a-z0-9]{12})&sessionKey=([a-z0-9]{32})(?:&guild(?:Id)?=([a-z0-9]{8}(?:\-[a-z0-9]{4}){3}\-[a-z0-9]{12}))?/);if(r){var a=(u=t.requestUrl,(s=i.find(function(e){return u.includes(e.url)}))&&s.action||null),o={action:a,playerGuid:r[1],sessionKey:r[2],guildGuid:r[3],data:t.responseJSON};if(!a)return;n.resolveListener(),e.Messenger.instance.postMessage(o)}}var u,s}r.addAction=function(e,t,r){i.push({action:e,url:t,callbackfn:r})},r.init=function(r,i){return void 0===i&&(i="http://bh.elvenintrigue.com/"),new Promise(function(u,s){var l=String(r&&r.location&&r.location.href||"").toLowerCase();e.isLocal=l.includes("battlehand-hud/default.htm")||l.includes("battlehand-hud/iframe.htm"),e.isHud=l.includes("battlehand-hud/default.htm")||l.startsWith("http://www.kongregate.com/games/anotherplaceprod/battlehand-web"),e.isListener=l.includes("battlehand-hud/iframe.htm")||l.startsWith("http://game261051.konggames.com/gamez/"),e.host=i,e.isHud?(r.bh=e,XmlHttpRequest.attach(r),e.loaded(r).then(function(){e.Messenger.initialize(r,a),e.data.init().then(function(){t.render(),e.Messenger.instance.postMessage(e.Messenger.createMessage("hud-init","hud-init")),u(r)},function(){return s("data.init rejected")})},function(e){return s("loaded(win) rejected: "+e)})):e.isListener?(n.setResolve(r,u),XmlHttpRequest.attach(r,o),e.Messenger.initialize(r,a)):s("not hud nor listener")})},r.handleReadyStateChange=u}((t=e.hud||(e.hud={})).listener||(t.listener={}))}(bh||(bh={})),function(e){var t;(t=e.hud||(e.hud={})).arena||(t.arena={}),t.listener.addAction("get-arena-matches","/v1/matchmaking/getmatches?",function(r){e.$('#brain-hud-scouter-player-target > option[value="arena"]').length||e.$("#brain-hud-scouter-player-target").children().first().after("<option value='arena'>Arena Opponents</option>");var n=r.data;e.data.arenaToPlayers(n).forEach(function(r,n){return t.scouter.loadPlayer(new e.Player(r,!0),n)}),e.$("#brain-hud-scouter-player-target").val("arena"),t.player.selectPlayerReport()})}(bh||(bh={})),function(e){var t;(function(r){function n(t){var r=e.data.guilds.findNameByGuid(t);if(!r)return console.log("guildName not found: "+t);var n=e.Player.me,a=n&&n.guildParent||null,o=a&&e.data.guilds.filterNamesByParent(a)||[],u=n&&n.canScout,s=n&&n.guildGuid==t;if(o.find(function(e){return e.guid==t})||u||s){!function(){if(!e.$("div.brain-hud-scouter-guild-container").length){var t=e.Player.me.canScout?'<textarea id="brain-hud-scouter-guild-report" rows="1" type="text" class="active"></textarea>':"";e.$("div.brain-hud-scouter-player-container").before('<div class="brain-hud-scouter-guild-container"><button class="bs-btn bs-btn-link bs-btn-xs brain-hud-toggle pull-right" data-action="toggle-guild-scouter">[-]</button><button class="bs-btn bs-btn-link bs-btn-xs brain-hud-toggle pull-right" data-action="refresh-guild">'+e.getImg12("icons","glyphicons-82-refresh")+'</button><select id="brain-hud-scouter-guild-target" data-action="toggle-scouter-guild"></select>'+t+"</div>")}e.$("div.brain-hud-scouter-guild-container").addClass("active")}();var l=e.$("#brain-hud-scouter-guild-target");l.find('option[value="'+t+'"]').length||(l.append('<option value="'+t+'">'+r.name+"</option>"),l.children().toArray().filter(function(e){return e.value!=n.guildGuid}).sort(function(e,t){return e.text<t.text?-1:e.text==t.text?0:1}).forEach(function(e){return l.append(e)})),l.val(t),i()}}function a(t){if(t&&t.value){var r=t.value,n=e.data.guilds.findNameByGuid(r),a=n&&n.leaderBoardEntry||null,i=""+(a&&"#"+(a.rank+1)+" "||"")+(a&&(a.wins||a.losses)&&"("+n.leaderBoardEntry.wins+"/"+n.leaderBoardEntry.losses+") "||"")+n.name;t.text=i}}function i(){var t=e.$("#brain-hud-scouter-guild-target").val();a(e.$('#brain-hud-scouter-guild-target > option[value="'+t+'"]')[0]),e.$("#brain-hud-scouter-guild-report").val(e.data.reports.getReport(t)[t]||"")}function o(e,r){return new Promise(function(n,a){var i,o=e.slice();!function e(){(i=o.shift())?setTimeout(function(){return u(i.id,r).then(e,e)},t._delayMS):n()}()})}function u(r,n){var a="https://battlehand-game-kong.anotherplacegames.com/v1/guild/getmembers?player="+e.Messenger.ActivePlayerGuid+"&sessionKey="+e.Messenger.ActiveSessionKey+"&guild="+r;return e.isLocal&&(a="./json/"+r+".json"),new Promise(function(i,o){return e.Messenger.ActivePlayerGuid&&e.Messenger.ActiveSessionKey?r?void XmlHttpRequest.getJSON(a).then(function(r){if(!r||!Array.isArray(r))return o("invalid json");if(e.Messenger.instance.postMessage(e.Messenger.createMessage("get-guild-members",r)),n){var a=r.map(function(e){return e.playerId});t.player.playersGet(a).then(i,i)}else i(r)},o):o("no guild id"):o("not initialized")})}r.addGuildReport=n,r.selectGuildReport=i,t.listener.addAction("get-guild","/v1/guild/get?",function(t){var r=t.data,a=r&&r.playerGuild&&r.playerGuild.id,i=r&&r.playerGuild&&r.playerGuild.name;a&&i&&(e.data.guilds.put(a,i),e.data.reports.putGuild(r),n(a))}),t.listener.addAction("get-guild-members","/v1/guild/getmembers?",function(t){var r=t.data,a=r[0].guildId;e.data.reports.putGuildMembers(r),n(a)}),t.listener.addAction("get-guild-war","/v1/guildwars/get?",function(t){var r=t.data;r&&r.guilds&&(r.guilds.forEach(function(t){return e.data.guilds.put(t.id,t.name)}),e.data.reports.putGuildWar(r),r.guilds.forEach(function(e){return n(e.id)}))}),t.listener.addAction("get-leaderboard","/v1/guildwars/getrange?",function(t){var r=t.data;e.data.guilds.updateLeaderBoard(r),e.$("#brain-hud-scouter-guild-target").children().toArray().forEach(a)}),t.listener.addAction("get-guildsearch","/v1/guild/getguilds?",function(t){t.data.forEach(function(t){return e.data.guilds.put(t.id,t.name)})}),t.listener.addAction("get-leaderboard-members","/v1/guildwars/getguildmembersrange?",function(e){n(e.guildGuid)}),r.searchGuilds=function(t,r){var n="https://battlehand-game-kong.anotherplacegames.com/v1/guild/getguilds?player="+e.Messenger.ActivePlayerGuid+"&sessionKey="+e.Messenger.ActiveSessionKey+"&name="+t+"&joinableonly=False&language=&minfamelevel=2&maxfamelevel=44";return new Promise(function(t,a){if(!e.Messenger.ActivePlayerGuid||!e.Messenger.ActiveSessionKey)return a("not initialized");XmlHttpRequest.getJSON(n).then(function(e){if(!e||!Array.isArray(e))return a("invalid json");o(e,r).then(t,a)},a)})},r.guildsGetMembers=o,r.guildGetMembers=u,r.leaderBoardGet=function(t,r){void 0===t&&(t=0),void 0===r&&(r=13);var n="https://battlehand-game-kong.anotherplacegames.com/v1/guildwars/getrange?player="+e.Messenger.ActivePlayerGuid+"&sessionKey="+e.Messenger.ActiveSessionKey+"&start="+t+"&count="+r;return e.isLocal&&(n="./json/top_guilds.json"),new Promise(function(t,r){if(!e.Messenger.ActivePlayerGuid||!e.Messenger.ActiveSessionKey)return r("not initialized");XmlHttpRequest.getJSON(n).then(function(n){if(!n||!n.leaderboardEntries)return r("invalid json");e.Messenger.instance.postMessage(e.Messenger.createMessage("get-leaderboard",n)),t(n)},r)})},t.listener.addAction("refresh-guild",null,function(e){u(e.data,!0)})})((t=e.hud||(e.hud={})).guild||(t.guild={}))}(bh||(bh={})),function(e){var t;(t=e.hud||(e.hud={}))._delayMS=500,function(r){function n(t){t.isExtended&&(e.$("#brain-hud-inventory").addClass("active"),e.data.PlayerRepo.put(t),e.$("#brain-hud-inventory-items-container").html("").append(t.boosterCards.map(function(e){return e.rowHtml})).append(t.battleCards.map(function(e){return e.rowHtml})).append(t.inventory.sort(e.utils.sort.byName).map(function(e){return e.rowHtml})).append(t.wildCards.map(function(e){return e.rowHtml})).append(t.boosterRowHtml).append(t.fragmentsRowHtml).append(t.gemsRowHtml).append(t.goldRowHtml).append(t.raidRowHtml).append(t.wildCardRowHtml),e.events.toggle())}function a(r){var a=r.data,o=new e.Player(a),u=e.$("#brain-hud-scouter-player-target");if(e.$('#brain-hud-scouter-player-target > option[value="'+o.guid+'"]').length||(u.append('<option value="'+o.guid+'">'+(o.isFullMeat?"&#9734; ":"")+e.utils.htmlFriendly(o.name)+"</option>"),u.children().toArray().slice(1).sort(function(e,t){return e.text<t.text?-1:e.text==t.text?0:1}).forEach(function(e){return u.append(e)})),o.isMe&&!o.isExtended||e.data.PlayerRepo.put(o),t.scouter.loadPlayer(o),o.isMe){n(o);var s=o.guilds;s.length&&t.guild.addGuildReport&&s.forEach(function(e){return t.guild.addGuildReport(e.guid)})}u.val(a.id),i(),t.guild.selectGuildReport()}function i(){e.$("div.brain-hud-scouter-player-container").addClass("active"),e.$("#brain-hud-scouter-player-report").show(),e.$("div.brain-hud-scouter-player").removeClass("active");var t=e.$("#brain-hud-scouter-player-target").val();"arena"==t?(e.$('div.brain-hud-scouter-player[data-guid="arena-0"]').addClass("active"),e.$('div.brain-hud-scouter-player[data-guid="arena-1"]').addClass("active"),e.$('div.brain-hud-scouter-player[data-guid="arena-2"]').addClass("active")):e.$('div.brain-hud-scouter-player[data-guid="'+t+'"]').addClass("active")}function o(t){var r="https://battlehand-game-kong.anotherplacegames.com/v1/player/getplayerinfo?player="+e.Messenger.ActivePlayerGuid+"&sessionKey="+e.Messenger.ActiveSessionKey+"&id_requested_player="+t;return e.isLocal&&(r="./json/"+t+".json"),new Promise(function(n,a){return e.Messenger.ActivePlayerGuid&&e.Messenger.ActiveSessionKey?t?void XmlHttpRequest.getJSON(r).then(function(t){if(!t)return a("invalid json");e.Messenger.instance.postMessage(e.Messenger.createMessage("get-player",t)),n(t)},a):a("no player id"):a("not initialized")})}r.loadPlayer=n,r.addPlayerReport=a,r.selectPlayerReport=i,t.listener.addAction("get-player","/v1/player/get?",a),t.listener.addAction("get-player","/v1/player/getplayerinfo?",a),r.playersGet=function(e){return new Promise(function(r,n){var a,i=e.slice();!function e(){(a=i.shift())?setTimeout(function(){return o(a).then(e,e)},t._delayMS):r()}()})},r.playerGet=o,t.listener.addAction("refresh-player",null,function(e){o(e.data)})}(t.player||(t.player={}))}(bh||(bh={})),function(e){!function(e){e.getFromStorage=function(e){var t;try{t=localStorage.getItem(e)}catch(e){t=null}return t},e.setToStorage=function(e,t){var r=!1;try{localStorage.setItem(e,t),r=!0}catch(e){}return r},e.formatString=function(e,t){for(var r=new RegExp("\\w+"),n=e.match(new RegExp("#{\\w+}","g")),a=0,i=n.length;a<i;a++)n[a]=n[a].match(r)[0];var o=e;for(a=0,i=n.length;a<i;a++)for(var u=n[a],s=0,l=t.length;s<l;s++){var c=t[s];if(u in c){o=o.replace("#{"+u+"}",c[u]);break}}return o},e.htmlFriendly=function(e){return String(e).replace(/\</g,"&lt;").replace(/\>/g,"&gt;")},e.unique=function(e){return e.reduce(function(e,t){return e.includes(t)?e:e.concat([t])},[])},e.formatNumber=function(e){for(var t=String(e).split(""),r=[],n=0,a=t.length;a--;)r.length&&n%3==0&&r.unshift(","),r.unshift(t.pop()),n++;return r.join("")},e.round=function(e,t){var r=10^t,n=e*r;return Math.round(n)/r},e.truncateNumber=function(t){var r=e.formatNumber(t),n=r.split(",");return 1==n.length?r:1==n[0].length?n[0]+"."+n[1][0]+"k":n[0]+"k"},e.parseBoolean=function(e){var t=String(e),r=t.substring(0,1).toLowerCase();return"y"===r||"t"===r||"1"===t},e.evoToStars=function(e,t){void 0===t&&(t=String(e+1));for(var r=+t.split(".")[0],n=e+1,a=0,i="";r--;)a++,i+="<span class='evo-star'>&#9733;</span>";for(;a<n;)a++,i+="<span class='star'>&#9734;</span>";return i},e.getBase64Image=function(e){var t=document.createElement("img");t.setAttribute("src",e);var r=document.createElement("canvas");return r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(t,0,0),r.toDataURL("image/png")};var t={};e.logMissingCard=function(e){t[e.playerCard.id]||(console.log("Missing BattleCard:",e.name+": "+e.playerCard.id+" ("+e.evoLevel+")"),t[e.playerCard.id]=!0)},e.asyncForEach=function(e,t,r){return new Promise(function(n,a){var i=e.map(function(e,n,i){return function(e,n,i){setTimeout(function(e,r,n,i){try{var u=t.call(e,r,n,i);u instanceof Promise?u.then(o,a):o()}catch(e){a(e)}},0,r,e,n,i)}.bind(r,e,n,i)}),o=function(){if(i.length){var t=i.shift();t?t():o()}else n(e)};o()})},e.clone=function(e){var t={};return Object.keys(e).forEach(function(r){return t[r]=e[r]}),t},e.isNullOrUndefined=function(e){return null===e||void 0===e}}(e.utils||(e.utils={}))}(bh||(bh={})),function(e){!function(t){function r(){var r=t.WidthCurrent!=t.WidthCollapsed;e.$("div#brain-hud-container").css("width",t.WidthCurrent),e.$("div.brain-hud-main-container")[r?"addClass":"removeClass"]("active"),e.$("div.brain-hud-header>span.header")[r?"show":"hide"](),e.$('div.brain-hud-header>span[data-action="toggle-hud-smaller"]')[r?"show":"hide"](),e.$("div#brain-hud-container").css("width",t.WidthCurrent),e.$("div#brain-hud-container").css("max-height",jQuery(window).height()-10),e.$("div.brain-hud-container select").css("width",t.WidthCurrent-70),e.$("div.brain-hud-container textarea").css("width",t.WidthCurrent-10),e.$("div.brain-hud-scouter-panel-header > button").css("width",t.WidthCurrent-10),e.$("div.brain-hud-scouter-panel-header > button > span.hero-rating-bar").css("width",t.WidthCurrent-205)}function n(t,r,n,a){return'<button class="bs-btn bs-btn-default brain-hud-button" type="button" data-action="toggle-'+t+'" data-'+t+'="'+r+'">'+e.getImg(n,a||r)+"</button>"}t.WidthDefault=275,t.WidthCurrent=+e.utils.getFromStorage("BH-HUD-WidthCurrent")||t.WidthDefault,t.WidthMinimum=200,t.WidthDelta=25,t.WidthCollapsed=25,t.render=function(){var a;e.$().get("https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css").then(function(r){var n;e.$("head").append('<style type="text/css">'+r.replace(/\.btn/g,".bs-btn")+"</style>"),n='<style id="brain-hud-styles" type="text/css">\ndiv.brain-hud-container { font-size:8pt; position:fixed; top:0; right:0; width:'+t.WidthCurrent+"px; background:#FFF; color:#000; border:2px solid #000; z-index:9999; padding:2px; max-height:"+(jQuery(window).height()-10)+"px; overflow:auto; }\ndiv.brain-hud-container div { clear:both; }\ndiv.brain-hud-container table { width:100%; margin:0; padding:0; border:0; }\ndiv.brain-hud-container td { padding:0; margin:0; border:0; }\ndiv.brain-hud-container select { width:"+(t.WidthCurrent-70)+"px; }\ndiv.brain-hud-container textarea { width:"+(t.WidthCurrent-10)+"px; font-size:8pt; display:none; }\n\ndiv.brain-hud-container .Air { background-color:#f3f3f3; }\ndiv.brain-hud-container .Earth { background-color:#e0eed5; }\ndiv.brain-hud-container .Fire { background-color:#fce5cd; }\ndiv.brain-hud-container .Spirit { background-color:#f3e2f6; }\ndiv.brain-hud-container .Water { background-color:#deeaf4; }\ndiv.brain-hud-container .grayscale { filter: grayscale(100%); }\n\ndiv.brain-hud-header { text-align:center; font-weight:bold; }\n\ndiv.brain-hud-main-container,\ndiv.brain-hud-scouter-guild-container,\ndiv.brain-hud-scouter-player-container,\ndiv.brain-hud-scouter-player,\ndiv.brain-hud-scouter-panel-content,\ndiv.brain-hud-inventory,\ndiv.brain-hud-inventory-container,\ndiv.brain-hud-child-scroller { display:none; }\n\ndiv.brain-hud-scouter-panel-content,\ndiv.brain-hud-child-scroller { padding-left:10px; }\n\ndiv.brain-hud-scouter-player-report { display:none; padding:0 2px; text-align:left; }\ndiv.brain-hud-scouter-player > div.player-name { font-size:10pt; font-weight:bold; text-align:center; }\n\ndiv.brain-hud-scouter-panel-header { padding:2px 0 0 0; }\ndiv.brain-hud-scouter-panel-header > button { cursor:default; border:0; width:"+(t.WidthCurrent-10)+"px; text-align:left; padding:0; margin:0; }\ndiv.brain-hud-scouter-panel-header > button[data-action] { cursor:pointer; }\ndiv.brain-hud-scouter-panel-header > button > span.hero-icon { display:inline-block; width:20px; text-align:center; }\ndiv.brain-hud-scouter-panel-header > button > span.hero-level { display:inline-block; width:30px; text-align:right; }\ndiv.brain-hud-scouter-panel-header > button > span.hero-name { display:inline-block; width:60px; }\ndiv.brain-hud-scouter-panel-header > button > span.hero-hp { display:inline-block; width:50px; text-align:center; overflow:hidden; vertical-align: bottom; }\ndiv.brain-hud-scouter-panel-header > button > span.hero-rating-bar { display:inline-block; width:"+(t.WidthCurrent-205)+'px; }\ndiv.brain-hud-scouter-panel-header > button > span.hero-rating { display:inline-block; width:30px; text-align:right; font-size:8pt; vertical-align:top; }\n\ndiv.brain-hud-inventory-buttons { text-align:center; }\n\ndiv.brain-hud-container .active { display:block; }\n\ndiv.brain-hud-container .star { color: darkgoldenrod; text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black; }\ndiv.brain-hud-container .evo-star { color: gold; text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black; }\n\ndiv.brain-hud-container img { height:16px; width:16px; }\ndiv.brain-hud-container img.icon-12 { height:12px; width:12px; }\ndiv.brain-hud-container img.icon-20 { height:20px; width:20px; }\n\ndiv.brain-hud-child-scroller { max-height:180px; overflow:auto; }\ndiv.brain-hud-scouter-panel-content.active,\ndiv.brain-hud-child-scroller.active { border:1px solid #aaa; border-radius:10px; }\n\ndiv.progress { margin-bottom:0; height:10px; }\ndiv.progress > div.progress-bar { line-height:10px; font-size:8px; font-weight:bold; clear:none; }\n\ndiv.brain-hud-container .badge,\ndiv.brain-hud-container .bs-btn-group-xs > .bs-btn,\ndiv.brain-hud-container .bs-btn-xs { font-size:11px; }\n\ndiv.brain-hud-container .badge.bg-success { background-color:#3c763d; }\ndiv.brain-hud-container .badge.bg-danger { background-color:#a94442; }\ndiv.brain-hud-container [data-action="sort-heroes"] { cursor:pointer; }\n</style>',e.$("head").append(n)}),a='<div class="brain-hud-header">\n\t<button class="bs-btn bs-btn-link bs-btn-xs brain-hud-toggle pull-left" data-action="toggle-hud-bigger">[+]</button>\n\t<button class="bs-btn bs-btn-link bs-btn-xs brain-hud-toggle pull-right" data-action="toggle-hud-smaller">[-]</button>\n\t<span class="header">BattleHand HUD (Umbrella Mod 4.2 [Customized by WizardHcker])</span>\n</div>\n<div class="brain-hud-main-container active">\n\t<div class="brain-hud-scouter-player-container">\n\t\t<button class="bs-btn bs-btn-link bs-btn-xs brain-hud-toggle pull-right" data-action="toggle-player-scouter">[-]</button>\n\t\t<button class="bs-btn bs-btn-link bs-btn-xs brain-hud-toggle pull-right" data-action="refresh-player">'+e.getImg12("icons","glyphicons-82-refresh")+'</button>\n\t\t<select id="brain-hud-scouter-player-target" data-action="toggle-scouter-player"></select>\n\t\t<div id="brain-hud-scouter-player-report" class="brain-hud-scouter-player-report active"></div>\n\t</div>\n\t<div id="brain-hud-inventory" class="brain-hud-inventory">\n\t\t<strong>Inventory</strong>\n\t\t<button class="bs-btn bs-btn-link bs-btn-xs" style="float:center;" data-action="hud-to-library">[library]</button>\n\t\t<button class="bs-btn bs-btn-link bs-btn-xs brain-hud-toggle pull-right" data-action="toggle-inventory">[-]</button>\n\t\t<div class="brain-hud-inventory-container active">\n\t\t\t<div class="text-center">\n\t\t\t\t<div class="bs-btn-group bs-btn-group-xs brain-hud-inventory-buttons" role="group">\n\t\t\t\t\t'+n("element",e.ElementType.Air,"elements","Air")+"\n\t\t\t\t\t"+n("element",e.ElementType.Earth,"elements","Earth")+"\n\t\t\t\t\t"+n("element",e.ElementType.Fire,"elements","Fire")+"\n\t\t\t\t\t"+n("element",e.ElementType.Spirit,"elements","Spirit")+"\n\t\t\t\t\t"+n("element",e.ElementType.Water,"elements","Water")+"\n\t\t\t\t\t"+n("element",e.ElementType.Neutral,"elements","Loop")+'\n\t\t\t\t</div>\n\t\t\t\t<div class="bs-btn-group bs-btn-group-xs brain-hud-inventory-buttons">\n\t\t\t\t\t'+n("klass",e.KlassType.Magic,"classes","Magic")+"\n\t\t\t\t\t"+n("klass",e.KlassType.Might,"classes","Might")+"\n\t\t\t\t\t"+n("klass",e.KlassType.Skill,"classes","Skill")+"\n\t\t\t\t\t"+n("klass","Brag","cardtypes")+"\n\t\t\t\t\t"+n("type",e.ItemType.Rune,"runes","Meteor")+"\n\t\t\t\t\t"+n("type",e.ItemType.Crystal,"crystals","Neutral")+'\n\t\t\t\t</div><br/>\n\t\t\t\t<div class="bs-btn-group bs-btn-group-xs brain-hud-inventory-buttons">\n\t\t\t\t\t'+n("type","BoosterCard","misc","Boosters")+"\n\t\t\t\t\t"+n("type","WildCard","cardtypes","WildCard")+"\n\t\t\t\t\t"+n("type",e.ItemType.EvoJar,"misc","EvoJars")+'\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div id="brain-hud-inventory-items-container" class="brain-hud-inventory-items-container"></div>\n\t\t</div>\n\t</div>\n</div>',e.$("body").append('<div id="brain-hud-container" class="brain-hud-container">'+a+"</div>"),r(),e.events.init()},t.resize=function(n){n?(t.WidthCurrent+=t.WidthDelta,t.WidthCurrent<t.WidthMinimum&&(t.WidthCurrent=t.WidthMinimum)):n||(t.WidthCurrent-=t.WidthDelta,t.WidthCurrent&&t.WidthCurrent<t.WidthMinimum&&(t.WidthCurrent=t.WidthCollapsed),t.WidthCurrent||(t.WidthCurrent=t.WidthCollapsed)),e.utils.setToStorage("BH-HUD-WidthCurrent",String(t.WidthCurrent)),r()}}(e.hud||(e.hud={}))}(bh||(bh={})),function(e){var t;t=e.hud||(e.hud={}),function(r){function n(t,r){void 0===r&&(r=-1);var n,a=t.isFullMeat,i=a?"&#9734;":"",o=t.isArena||a?"":' <span style="white-space:nowrap;">('+t.completionPercent+"%)</span>",u='<div class="player-name" data-action="sort-heroes">'+i+" "+e.utils.htmlFriendly(t.name)+" "+o+"</div>";t.heroes.sort(e.utils.sort.byElementThenKlass).forEach(function(r){if(t.isMe||!r.isLocked){var n,a,i,o,s,l,c=t.guid+"-"+r.guid,d=r.isLocked?e.getImg("misc","Lock"):e.getImg("heroes",r.name),p=r.isLocked?"":r.level==e.HeroRepo.MaxLevel?r.isMeat?'<span class="evo-star">&#9734;</span>':'<span class="star">&#9734;</span>':"("+r.level+")",f=r.isLocked?"":e.utils.truncateNumber(r.hitPoints)+" HP",y=r.hero.maxPowerThresholds,g=r.powerRating,h=Math.round(100*g/y[g<y[3]?3:4]),m=r.isOp?"background-color:pink;":"",b=g<=y[0]?"progress-bar-info":g<=y[1]?"progress-bar-success":g<=y[2]?"progress-bar-warning":"progress-bar-danger",v=r.isLocked?"":'<div class="progress" style="'+m+'"><div class="progress-bar '+b+'" style="width:'+h+'%;"><span></span></div></div>',T=r.isLocked?"":g,R='<span class="hero-icon">'+d+'</span><span class="hero-name">'+r.name+'</span><span class="hero-level">'+p+'</span><span class="hero-hp">'+f+'</span><span class="hero-rating-bar">'+v+'</span><span class="hero-rating">'+T+'</span><span class="hero-max"> '+y[4]+"</span>",C="";if(t.isMe||t.isAlly){var P=r.playerHeroAbilities.map(function(t){var n=t.isMaxed?"; maxed":t.isCapped?"; capped":"",a=t.isLocked?e.getImg("misc","Lock"):"("+t.level+" / "+t.levelMax+n+")",i=t.img+" "+t.name+" "+a,o="";return t.isMaxed||(o+=t.materialHtml,o+=t.goldHtml),e.renderExpandable(r.guid+t.guid,i,o)}),x=r.deck.map(function(e){return e.rowHtml}).join("");C=""+P.join("")+x}u+=(n=c,a=r.elementType,i=R,o=C,s=t.isMe||t.isAlly,l='<button class="bs-btn bs-btn-link bs-btn-sm '+e.ElementType[a]+'" '+(s?'data-action="toggle-scouter-hero"':"")+">"+i+"</button>",'<div class="brain-hud-scouter-panel" data-guid="'+n+'"><div class="brain-hud-scouter-panel-header">'+l+'</div><div class="brain-hud-scouter-panel-content">'+o+"</div></div>")}}),(n=-1==r?t.guid:"arena-"+r,e.$('div.brain-hud-scouter-player[data-guid="'+n+'"]').length||e.$("div#brain-hud-scouter-player-report").append('<div class="brain-hud-scouter-player" data-guid="'+n+'"></div>'),e.$('div.brain-hud-scouter-player[data-guid="'+n+'"]')).html(u)}(t.scouter||(t.scouter={})).loadPlayer=n}()}(bh||(bh={})),function(e){!function(t){var r,n,a=window.jQuery,i=null;function o(e){return e.trim().replace(/\W/g,"")}function u(t,n){void 0===n&&(n=null);var a=e.Messenger.createMessage(t,{action:t,data:n});a.playerGuid=t,a.sessionKey=t,r.postMessage(a)}function s(t){var r=t.data||t.originalEvent&&t.originalEvent.data||null;r&&("hud-sending-player"==r.action&&r.data&&(i=new e.Player(r.data),l()),"library-requesting-player"==r.action&&u("hud-sending-player",e.Player.me._pp))}function l(){e.host="http://bh.elvenintrigue.com",e.data.init().then(I),a("body").on("click",'[data-action="show-card"]',h),a("body").on("click",'[data-action="show-item"]',g),a("body").on("click","[data-search-term]",c),a("input.library-search").on("change keyup",T),a("button.library-search-clear").on("click",d),a("input[type='range']").on("change input",p);var t=a("#card-evolution div.tab-pane"),r=t.html();t.html(r).toArray().forEach(function(e,t){return a(e).find("h3").text("Evolution from "+t+" to "+(t+1))})}function c(e){var t=a(e.target).closest("[data-search-term]").attr("data-search-term"),r=t.toLowerCase(),n=a("input.library-search"),i=n.val();i.trim().toLowerCase().split(/\s+/).includes(r)||(n.focus().val((i+" "+t).trim()).blur(),R((i+" "+t).trim().toLowerCase()))}function d(){b=null,a("input.library-search").val(""),a('a[href="#card-table"] > span.badge').text(String(e.data.BattleCardRepo.length)),a('a[href="#effect-table"] > span.badge').text(String(e.data.EffectRepo.length)),a('a[href="#item-table"] > span.badge').text(String(e.data.ItemRepo.length)),a("tbody > tr[id]").show()}function p(t){var r=a("#card-slider-evo").val(),i=a("#card-slider-level").val();a(t.target).closest("input[data-action]").data("action");a("#card-slider-types").html('<span style="padding-left:25px;">'+r+"."+("0"+i).substr(-2)+"</span><br/>"+n.typesTargets.map(function(t,n){return e.getImg20("cardtypes",t.split(" ")[0].replace("Damage","Attack"))+" "+t+" ("+e.utils.formatNumber(f(n,r,i))+")"}).join("<br/>"))}function f(t,r,a){var i={configId:n.guid,evolutionLevel:r,level:a};return e.BattleCardRepo.calculateValue(i,t)}function y(e){return f(e,0,0)}function g(t){var r=a(t.target).closest("tr").attr("id"),n=e.data.ItemRepo.find(r);n,a("div.modal-item").modal("show"),a("#item-name").html(n.name+" &nbsp; "+k([n.name]).join(" ")),a("#item-rarity").html(e.utils.evoToStars(n.rarityType)+" "+e.RarityType[n.rarityType]),a("#item-element").html(e.ElementRepo.toImage(n.elementType)+" "+e.ElementType[n.elementType]);var i=e.data.DungeonRepo.getDropRates(n.name).map(function(e){return"<tr><td>"+e.dungeon.name+"</td><td>"+e.dungeon.keys+" keys</td><td>"+Math.round(1e3*e.dropRate.averagePerKey)/10+"% / key</td></tr>"}).join("");a("#item-dungeons").html('<table class="table table-striped table-condensed"><tbody>'+i+"</tbody></table>")}function h(t){var r=a(t.target).closest("tr").attr("id"),i=e.data.BattleCardRepo.find(r);n=i,a("div.modal-card").modal("show"),a("#card-name").html(i.name+" &nbsp; "+O(i).join(" ")),a("#card-image").attr("src",e.getSrc("battlecards","blank",o(i.name))),a("#card-element").html(e.ElementRepo.toImage(i.elementType)+" "+e.ElementType[i.elementType]),a("#card-klass").html(e.KlassRepo.toImage(i.klassType)+" "+e.KlassType[i.klassType]),a("#card-klass").removeClass("Magic Might Skill").addClass(e.KlassType[i.klassType]),a("#card-rarity").html(e.utils.evoToStars(i.rarityType)+" "+e.RarityType[i.rarityType]),a("#card-types").html(i.typesTargets.map(function(t,r){return e.getImg20("cardtypes",t.split(" ")[0].replace("Damage","Attack"))+" "+t.split(" ")[0].replace("Damage","Attack")+" ("+e.utils.formatNumber(y(r))+" - "+e.utils.formatNumber(f(r,n.rarityType+1,e.BattleCardRepo.getLevelsForRarity(n.rarityType)-1))+")"}).join("<br/>")),a("#card-turns").html(String(i.turns)),a("div.panel-card span.card-brag").html(String(i.brag)),a("div.panel-card span.card-min").html(i.minValues.map(function(e){return e.join()}).join(" :: ")),a("div.panel-card span.card-max").html(i.maxValues.join(" :: ")),a("div.panel-card span.card-mats").html(i.mats.join()),a("#card-targets").html(e.EffectRepo.mapTargets(i).map(function(t){return e.EffectRepo.toImage(t)+" "+t.name+"<br/>"}).join("")),a("#card-effects").html(e.EffectRepo.mapEffects(i).map(function(t){return e.EffectRepo.toImage(t)+" "+t.name+"<br/>"}).join("")),a("#card-perks").html(e.EffectRepo.mapPerks(i).map(function(t){return e.EffectRepo.toImage(t)+" "+t.name}).join("<br/>")),a("div.panel-card span.card-perk").html(i.perkBase+"%"),a("#card-mats").html(i.mats.map(function(t){return e.data.ItemRepo.find(t)}).map(function(t){return e.ItemRepo.toImage(t)+" "+t.name}).join("<br/>"));var u=new e.Recipe(i),s=0,l=0,c=a("#card-evolution > ul.nav > li").toArray();[0,1,2,3,4].forEach(function(t){var r=u.evos[t],n="#evo-"+t+"-"+(t+1),d=a(c[t]).removeClass("disabled");if(!r)return a(n+" tbody").html(""),void d.addClass("disabled");var p="",f=e.data.getMinGoldNeeded(i.rarityType,r.evoFrom),y=e.data.getMaxGoldNeeded(i.rarityType,r.evoFrom);if(s+=f,l+=y,p+=m(e.getImg("misc","Coin"),"Gold",f,y),r.items.filter(function(e){return!!e.max}).forEach(function(t){return p+=m(e.getImg20("evojars",o(t.item.name)),t.item.name,t.min,t.max)}),5==r.evoTo){var g=e.data.ItemRepo.crystals.find(function(e){return e.elementType==i.elementType}),h=e.data.HeroRepo.all.find(function(e){return e.elementType==i.elementType&&e.klassType==i.klassType}),b=e.data.ItemRepo.runes.find(function(e){return e.name.startsWith(h.name)});p+=m(e.getImg20("crystals",e.ElementType[i.elementType]),g.name,e.data.getMinCrystalsNeeded(i.rarityType,r.evoFrom),e.data.getMaxCrystalsNeeded(i.rarityType,r.evoFrom)),p+=m(e.getImg20("runes",o(h.trait.name)),b.name,e.data.getMinRunesNeeded(i.rarityType,r.evoFrom),e.data.getMaxRunesNeeded(i.rarityType,r.evoFrom))}a(n+" tbody").html(p)});u.all;var d=a("#evo-all tbody").html("");if(d.append(m(e.getImg("misc","Coin"),"Gold",s,l)),u.all.forEach(function(t){d.append(m(e.getImg20("evojars",o(t.item.name)),t.item.name,t.min,t.max))}),i.rarityType==e.RarityType.Legendary){var p=e.data.ItemRepo.crystals.find(function(e){return e.elementType==i.elementType}),g=e.data.HeroRepo.all.find(function(e){return e.elementType==i.elementType&&e.klassType==i.klassType}),h=e.data.ItemRepo.runes.find(function(e){return e.name.startsWith(g.name)});d.append(m(e.getImg20("crystals",e.ElementType[i.elementType]),p.name,e.data.getMinCrystalsNeeded(i.rarityType,0),e.data.getMaxCrystalsNeeded(i.rarityType,4))),d.append(m(e.getImg20("runes",o(g.trait.name)),h.name,e.data.getMinRunesNeeded(i.rarityType,0),e.data.getMaxRunesNeeded(i.rarityType,4)))}a("#card-evolution .active").removeClass("active"),a("#card-evolution > ul.nav > li").first().addClass("active"),a("#card-evolution > div.tab-content > div.tab-pane").first().addClass("active"),a("#card-slider-evo").val(0).attr("max",i.rarityType+1),a("#card-slider-evo-labels-table tbody").html(new Array(i.rarityType+2).fill(1).map(function(e,t){return'<td class="text-'+(t?t==i.rarityType+1?"right":"center":"left")+'">'+t+"</td>"}).join(""));var b=e.BattleCardRepo.getLevelsForRarity(i.rarityType),v=10==b?[1,5,10]:20==b?[1,5,10,15,20]:35==b?[1,5,10,15,20,25,30,35]:[1,10,20,30,40,50];a("#card-slider-level").val(1).attr("max",b),a("#card-slider-level-labels-table tbody").html(v.map(function(e,t){return'<td class="text-'+(t?t==v.length-1?"right":"center":"left")+'">'+e+"</td>"}).join("")),a("#card-slider-types").html('<span style="padding-left:25px;">0.01</span><br/>'+i.typesTargets.map(function(t,r){return e.getImg20("cardtypes",t.split(" ")[0].replace("Damage","Attack"))+" "+t+" ("+e.utils.formatNumber(y(r))+")"}).join("<br/>"))}function m(t,r,n,a){return'<tr><td class="icon">'+t+'</td><td class="name">'+r+'</td><td class="min">'+e.utils.formatNumber(n)+'</td><td class="max">'+e.utils.formatNumber(a)+"</td></tr>"}t.openLibraryFromHud=function(){r=new e.Messenger(window,s,window.open(e.host+"/cards.html?hud,complete","bh-hud-library","",!0))},t.init=function(){location.search.includes("hud")?(r=new e.Messenger(window,s,window.opener),u("library-requesting-player")):l()},t.handleLibraryMessage=s;var b,v={card:{},effect:{},item:{},dungeon:{}};function T(e){R(a(e.target).val().trim().toLowerCase())}function R(t){if(!t)return d();b=t,["card","effect","item","dungeon"].forEach(function(r){return setTimeout(function(t){!function(t,r){if(!v[t][r]){var n=r.split(/\s+/);v[t][r]=C(t).filter(function(r){return!n.find(function(n){return!function(t,r,n){if("effect"==t)return M(r,n);E||(E=e.data.HeroRepo.all.map(function(e){return e.lower}));return x.includes(n)||w.includes(n)||E.includes(n)?(a=r,i=n,a.find(function(e){return e==i})):M(r,n);var a,i}(t,P[r.guid]||[],n)})}).map(function(e){return e.guid})}var i=a('a[href="#'+t+'-table"] > span.badge'),o=v[t][r]||[],u=C(t).map(function(e){return e.guid}).filter(function(e){return!o.includes(e)});if(r!=b)return;a("#"+o.join(",#")).show(),a("#"+u.join(",#")).hide(),i.text(String(o.length))}(r,t)},0,t)})}function C(t){switch(t){case"card":return e.data.BattleCardRepo.all;case"effect":return e.data.EffectRepo.all;case"item":return e.data.ItemRepo.all;case"dungeon":return e.data.DungeonRepo.all;default:return[]}}var P={};var x=e.ElementRepo.allTypes.map(function(t){return e.ElementType[t].toLowerCase()}),w=e.RarityRepo.allTypes.map(function(t){return e.RarityType[t].toLowerCase()}),E=null;function M(e,t){return e.find(function(e){return e.includes(t)})}function j(t){return(r=t,n=[],e.EffectRepo.mapTargets(r).forEach(function(e){return n.includes(e)?void 0:n.push(e)}),e.EffectRepo.mapEffects(r).forEach(function(e){return n.includes(e)?void 0:n.push(e)}),e.EffectRepo.mapPerks(r).forEach(function(e){return n.includes(e)?void 0:n.push(e)}),n.reduce(function(e,t){return["Self","Single"].includes(t.name)?e:e.concat([t])},[])).map(function(e){return A(e.guid,e.name.replace("Splash Damage","Splash").replace("Multi-Target (Ally)","Multi").replace("Multi-Target (Enemy)","Multi"),e.name+": "+e.description)});var r,n}function k(t){return t.map(function(t){return e.data.ItemRepo.find(t)}).map(function(t){return A(t.guid,t.name,t.name+": "+e.RarityType[t.rarityType]+" "+e.ElementType[t.elementType]+" "+e.ItemType[t.itemType]+" ("+e.utils.formatNumber(e.ItemRepo.getValue(t.itemType,t.rarityType))+" gold)")})}function O(t){return e.data.HeroRepo.all.filter(function(r){return(t.elementType==e.ElementType.Neutral||r.elementType==t.elementType)&&r.klassType==t.klassType}).map(function(t){return A(t.guid,t.name,t.name+": "+e.ElementType[t.elementType]+" "+e.KlassType[t.klassType]+" Hero")})}function H(t){return'<span class="stars" title="'+e.RarityType[t]+'" data-toggle="tooltip" data-placement="top">'+e.utils.evoToStars(t)+"</span>"}function I(){e.css.addCardTypes(a),e.css.addEffects(a),e.css.addElements(a),e.css.addHeroes(a),e.css.addItems(a),e.css.addKlasses(a),function(){var t=e.data.EffectRepo.all;a('a[href="#effect-table"] > span.badge').text(String(t.length));var r=a("table.effect-list > tbody");t.forEach(function(e){!function(e){if(!P[e.guid]){var t=P[e.guid]=[];t.push(e.description.toLowerCase()),t.push(e.lower)}P[e.guid]}(e);var t='<tr id="'+e.guid+'">';t+='<td><div class="bh-hud-image img-'+e.guid+'"></div></td>',t+='<td><span class="card-name">'+e.name+'</span><div class="visible-xs-block" style="border-top:1px dotted #666;">'+e.description+"</div></td>",t+='<td class="hidden-xs" style="width:100%;"><span class="card-description">'+e.description+"</span></td>",t+="</td></tr>",r.append(t)})}(),function(){var t=e.data.ItemRepo.all;a('a[href="#item-table"] > span.badge').text(String(t.length));var r=a("table.mat-list > tbody");t.forEach(function(t){var n=i&&i.inventory.find(function(e){return e.guid==t.guid});!function(t){if(!P[t.guid]){var r=P[t.guid]=[];r.push(e.ElementType[t.elementType].toLowerCase()),r.push(e.ItemType[t.itemType].toLowerCase()),r.push(t.lower),r.push(e.RarityType[t.rarityType].toLowerCase())}P[t.guid]}(t);var a='<tr id="'+t.guid+'">';a+='<td><div class="bh-hud-image img-'+t.guid+'"></div></td>',a+='<td><span class="card-name"><a class="btn btn-link" data-action="show-item" style="padding:0;">'+t.name+"</a></span></td>",a+="<td>"+H(t.rarityType)+"</td>",i&&(a+='<td><span class="badge">'+e.utils.formatNumber(n&&n.count||0)+"</span></td>"),a+='<td class="hidden-xs" style="width:100%;"></td>',a+="</td></tr>",r.append(a)})}(),function(){var t=location.search.includes("complete"),r=e.data.BattleCardRepo.all;a('a[href="#card-table"] > span.badge').text(String(r.length));var n=a("table.card-list > tbody").html("");r.forEach(function(r){!function(t){if(!P[t.guid]){var r=P[t.guid]=[];t.brag&&r.push("brag"),t.effects.forEach(function(e){return r.push(e.toLowerCase().replace(/shield break(er)?/,"crush"))}),r.push(e.ElementType[t.elementType].toLowerCase()),r.push(e.KlassType[t.klassType].toLowerCase()),r.push(t.lower),t.mats.forEach(function(e){return r.push(e.toLowerCase())}),t.perks.forEach(function(e){return r.push(e.toLowerCase())}),r.push(e.RarityType[t.rarityType].toLowerCase()),r.push(String(t.turns)),t.typesTargets.forEach(function(e){return r.push(e.toLowerCase().split(" (")[0])}),e.data.HeroRepo.all.filter(function(r){return r.klassType==t.klassType&&(t.elementType==e.ElementType.Neutral||r.elementType==t.elementType)}).forEach(function(e){return r.push(e.lower)}),i&&r.push(i.battleCards.find(function(e){return e.guid==t.guid})?"have":"need")}P[t.guid]}(r);var a=i&&i.battleCards.find(function(e){return r.guid==e.guid}),o='<tr id="'+r.guid+'">';i&&(o+='<td><span class="card-owned glyphicon '+(a?"glyphicon-ok text-success":"glyphicon-remove text-danger")+'" title="'+(a?"Have":"Need")+'" data-toggle="tooltip" data-placement="top"></span></td>'),o+='<td><div class="bh-hud-image img-'+(r.brag?"Brag":"BattleCard")+'" title="'+(r.brag?"Brag":"BattleCard")+'" data-toggle="tooltip" data-placement="top"></div></td>',o+='<td><span class="card-name"><a class="btn btn-link" data-action="show-card" style="padding:0;">'+r.name+"</a></span></td>",o+='<td class="text-center"><span class="card-rating">'+e.utils.formatNumber(e.PowerRating.rateBattleCard(r,e.MinMaxType.Max))+"</span></td>",t&&(o+='<td class="text-center" data-search-term="'+e.RarityType[r.rarityType]+'">'+H(r.rarityType)+"</td>"),t&&(o+="<td>"+A(e.ElementType[r.elementType])+"</td>"),t&&(o+="<td>"+A(e.KlassType[r.klassType],void 0,void 0,!0)+"</td>"),o+="<td>"+O(r).join("")+"</td>",t&&(o+='<td class="hidden-xs">'+j(r).join("")+"</td>"),t&&(o+='<td class="hidden-xs">'+k(r.mats).join("")+"</td>"),o+='<td class="hidden-xs" style="width:100%;"></td>',o+="</td></tr>",n.append(o)})}(),function(){var t=e.data.DungeonRepo.all;a('a[href="#dungeon-table"] > span.badge').text(String(t.length));var r=a("table.dungeon-list > tbody");t.forEach(function(t){!function(e){if(!P[e.guid]){var t=P[e.guid]=[];t.push(e.lower),e.mats.forEach(function(e){return t.push(e.name.toLowerCase())})}P[e.guid]}(t);var n='<tr id="'+t.guid+'">';n+='<td><span class="">'+t.name+"</span></td>",n+='<td><span class="">'+e.getImg20("keys","SilverKey")+" "+t.keys+"</span></td>",n+='<td><span class="">'+e.getImg20("misc","Fame")+" "+e.utils.formatNumber(t.fame)+"</span></td>",n+='<td><span class="">'+e.getImg20("keys","RaidTicket")+"</span></td>",n+='<td><span class="">'+e.getImg20("misc","Coin")+" "+e.utils.formatNumber(t.gold)+" <small>("+e.utils.formatNumber(Math.round(t.gold/t.keys))+" / key)</small></span></td>";try{n+='<td><span class="">'+t.elementTypes.map(function(t){return'<div class="bh-hud-image img-'+e.ElementType[t]+'"></div>'}).join("")+"</span></td>",n+="<td/>",n+="<td/>",n+="<td><span>"+k(t.mats.map(function(e){return e.name})).join("")+"</span></td>",n+='<td><span class="">'+t.randomMats.map(function(t,r){return t?e.getImg20("evojars","random",e.RarityType[r]+"_Neutral_Small")+t:""}).join(" ")+"</span></td>"}catch(e){console.error(e)}n+='<td class="hidden-xs" style="width:100%;"></td>',n+="</td></tr>",r.append(n)})}(),a("div.row.alert-row").remove(),a("div.row.table-row").show(),a('[data-toggle="tooltip"]').tooltip()}function A(e,t,r,n){return void 0===t&&(t=e),void 0===r&&(r=t),void 0===n&&(n=!1),'<div class="'+(n?"hidden-xs":"")+" bh-hud-image img-"+e+'" title="'+r+'" data-toggle="tooltip" data-placement="top" data-search-term="'+t+'"></div>'}}(e.library||(e.library={}))}(bh||(bh={})),function(e){var t;(function(t){function r(e,t){return e.elementType==t.elementType?0:e.elementType<t.elementType?-1:1}function n(e,t){return e.klassType==t.klassType?0:e.klassType<t.klassType?-1:1}function a(e,t){return e.evoLevel==t.evoLevel?0:+e.evoLevel<+t.evoLevel?-1:1}function i(e,t){var r=e.lower||e.name.toLowerCase(),n=e.lower||t.name.toLowerCase();return"sands of time"==r?-1:"sands of time"==n?1:r==n?0:r<n?-1:1}function o(t,r){var n=e.PositionType[t.position],a=e.PositionType[r.position];return n==a?0:n>a?-1:1}function u(e,t){return e.rarityType==t.rarityType?0:e.rarityType<t.rarityType?-1:1}function s(e,t){return u(e,t)||i(e,t)}t.byElement=r,t.byElementThenKlass=function(e,t){return r(e,t)||n(e,t)},t.byElementThenName=function(e,t){return r(e,t)||i(e,t)},t.byElementThenRarityThenName=function(e,t){return r(e,t)||s(e,t)},t.byKlass=n,t.byEvoLevel=a,t.byEvoLevelThenName=function(e,t){return a(e,t)||i(e,t)},t.byName=i,t.byPosition=o,t.byPositionThenName=function(e,t){return o(e,t)||i(e,t)},t.byRarity=u,t.byRarityThenName=s,t.byRarityThenNameThenEvoLevel=function(e,t){return u(e,t)||i(e,t)||a(e,t)}})((t=e.utils||(e.utils={})).sort||(t.sort={}))}(bh||(bh={}));var XmlHttpRequest=function(){function e(){var t=this;this.responseFilter=null;var r=e.original||XMLHttpRequest;this.xmlHttpRequest=new r,e.globalListeners.forEach(function(e){try{var r=e.slice(),n=r[1];r[1]=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];try{n.apply(t,e)}catch(e){console.error("XmlHttpRequest: Firing Global EventListener",e)}},t.addEventListener.apply(t,r)}catch(e){console.error("XmlHttpRequest: Adding Global EventListeners",e)}})}return Object.defineProperty(e.prototype,"onabort",{get:function(){return this.xmlHttpRequest.onabort},set:function(e){this.xmlHttpRequest.onabort=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onerror",{get:function(){return this.xmlHttpRequest.onerror},set:function(e){this.xmlHttpRequest.onerror=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onload",{get:function(){return this.xmlHttpRequest.onload},set:function(e){this.xmlHttpRequest.onload=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onloadend",{get:function(){return this.xmlHttpRequest.onloadend},set:function(e){this.xmlHttpRequest.onloadend=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onloadstart",{get:function(){return this.xmlHttpRequest.onloadstart},set:function(e){this.xmlHttpRequest.onloadstart=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onreadystatechange",{get:function(){return this.xmlHttpRequest.onreadystatechange},set:function(e){this.xmlHttpRequest.onreadystatechange=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onprogress",{get:function(){return this.xmlHttpRequest.onprogress},set:function(e){this.xmlHttpRequest.onprogress=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ontimeout",{get:function(){return this.xmlHttpRequest.ontimeout},set:function(e){this.xmlHttpRequest.ontimeout=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this.xmlHttpRequest.readyState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"response",{get:function(){return this.xmlHttpRequest.response},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseJSON",{get:function(){if("json"==this.responseType)return this.xmlHttpRequest.response;try{return JSON.parse(this.responseText)}catch(e){console.error("XmlHttpRequest.responseJSON",e)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseText",{get:function(){var t=this.responseType;if("arraybuffer"==t){var r=this.getResponseHeader("Content-Type"),n=r.match(/UTF\-32/i)?Uint32Array:r.match(/UTF\-16/i)?Uint16Array:Uint8Array;return e.arrayBufferToString(this.xmlHttpRequest.response,n)}return"json"==t?JSON.stringify(this.xmlHttpRequest.response):this.xmlHttpRequest.responseText},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseType",{get:function(){return this.xmlHttpRequest.responseType},set:function(e){this.xmlHttpRequest.responseType=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseXML",{get:function(){return this.xmlHttpRequest.responseXML},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this.xmlHttpRequest.status},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"statusText",{get:function(){return this.xmlHttpRequest.statusText},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeout",{get:function(){return this.xmlHttpRequest.timeout},set:function(e){this.xmlHttpRequest.timeout=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withCredentials",{get:function(){return this.xmlHttpRequest.withCredentials},set:function(e){this.xmlHttpRequest.withCredentials=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"upload",{get:function(){return this.xmlHttpRequest.upload},enumerable:!0,configurable:!0}),e.prototype.abort=function(){this.xmlHttpRequest.abort()},e.prototype.addEventListener=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.xmlHttpRequest.addEventListener.apply(this.xmlHttpRequest,e)},e.prototype.getAllResponseHeaders=function(){return this.xmlHttpRequest.getAllResponseHeaders()},e.prototype.getResponseHeader=function(e){return this.xmlHttpRequest.getResponseHeader(e)},e.prototype.open=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.method=e[0]||"",this.requestUrl=e[1]||"",this.xmlHttpRequest.open.apply(this.xmlHttpRequest,e)},e.prototype.overrideMimeType=function(e){this.xmlHttpRequest.overrideMimeType(e)},e.prototype.send=function(e){this.xmlHttpRequest.send(e)},e.prototype.setRequestHeader=function(e,t){this.xmlHttpRequest.setRequestHeader(e,t)},e.addEventListener=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e.globalListeners.push(t)},e.attach=function(t,r){e.original=t.XMLHttpRequest,t.XMLHttpRequest=e,r&&e.addEventListener("readystatechange",r)},e.uintArrayToString=function(e){try{for(var t=[],r=0,n=e.length;r<n;r+=32768)t.push(String.fromCharCode.apply(null,e.subarray(r,r+32768)));return decodeURIComponent(escape(t.join("")))}catch(e){console.error("XmlHttpRequest.uintArrayToString",e)}},e.stringToUintArray=function(e,t){try{for(var r=unescape(encodeURIComponent(e)).split(""),n=[],a=r.length;a--;)n[a]=r[a].charCodeAt(0);return new t(n)}catch(e){console.error("XmlHttpRequest.stringToUintArray",e)}},e.arrayBufferToString=function(t,r){try{r||(r=t instanceof Uint32Array?Uint32Array:t instanceof Uint16Array?Uint16Array:Uint8Array);var n=new r(t);return e.uintArrayToString(n)}catch(e){console.error("XmlHttpRequest.arrayBufferToString",e)}return null},e.get=function(t){return new Promise(function(r,n){var a=new e;a.addEventListener("readystatechange",function(){a.readyState==e.DONE&&r(a.responseText)}),a.open("GET",t,!0),a.send(null)})},e.getJSON=function(t){return new Promise(function(r,n){var a=new e;a.addEventListener("readystatechange",function(){a.readyState==e.DONE&&r(a.responseJSON)}),a.open("GET",t,!0),a.send(null)})},e.post=function(t,r,n){return new Promise(function(a,i){var o=new e;o.addEventListener("readystatechange",function(){o.readyState==e.DONE&&a(o)}),o.open("POST",t,!0),n&&o.setRequestHeader("Content-Type",n),o.send(r)})},e.DONE=XMLHttpRequest.DONE,e.HEADERS_RECEIVED=XMLHttpRequest.HEADERS_RECEIVED,e.LOADING=XMLHttpRequest.LOADING,e.OPENED=XMLHttpRequest.OPENED,e.UNSENT=XMLHttpRequest.UNSENT,e.globalListeners=[],e}();
